<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>第12讲 投资组合优化</title>
    <meta charset="utf-8" />
    <meta name="author" content=" 曾永艺" />
    <meta name="date" content="2022-12-09" />
    <script src="../libs/header-attrs/header-attrs.js"></script>
    <link href="../libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="../libs/tile-view/tile-view.js"></script>
    <link href="../libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <link href="../libs/panelset/panelset.css" rel="stylesheet" />
    <script src="../libs/panelset/panelset.js"></script>
    <link href="../libs/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <script src="../libs/clipboard/clipboard.min.js"></script>
    <link href="../libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="../libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-copy\"><\/i>","success":"<i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"<i class=\"fa fa-times-circle\" style=\"color: #F94144\"><\/i>"})</script>
    <link href="../libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="../libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <script src="../libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="../libs/jquery/jquery.min.js"></script>
    <link href="../libs/dygraphs/dygraph.css" rel="stylesheet" />
    <script src="../libs/dygraphs/dygraph-combined.js"></script>
    <script src="../libs/dygraphs/shapes.js"></script>
    <script src="../libs/moment/moment.js"></script>
    <script src="../libs/moment-timezone/moment-timezone-with-data.js"></script>
    <script src="../libs/moment-fquarter/moment-fquarter.min.js"></script>
    <script src="../libs/dygraphs-binding/dygraphs.js"></script>
    <script src="../libs/plotly-binding/plotly.js"></script>
    <script src="../libs/typedarray/typedarray.min.js"></script>
    <link href="../libs/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
    <script src="../libs/crosstalk/js/crosstalk.min.js"></script>
    <link href="../libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="../libs/plotly-main/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="../libs/zen-styles-v2.3.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# 量化金融与金融编程
]
.subtitle[
## L12 投资组合优化
]
.author[
### <br>曾永艺
]
.institute[
### 厦门大学管理学院
]
.date[
### <br>2022-12-09
]

---

class: inverse, center, middle



<div>
<style type="text/css">.xaringan-extra-logo {
width: 50px;
height: 50px;
z-index: 0;
background-image: url(imgs/logo-sm.png);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
top:0.5em;right:0.5em;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide):not(.inverse):not(.hide_logo)')
        .forEach(function (slide) {
          const logo = document.createElement('div')
          logo.classList = 'xaringan-extra-logo'
          logo.href = null
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div>

# 1. 投资组合优化

.font150[_Portfolio Optimization_]

---
class: middle

&lt;img src="imgs/naive.png" width="90%" style="display: block; margin: auto;" /&gt;

---
class: middle

&lt;img src="imgs/mark.png" width="100%" style="display: block; margin: auto;" /&gt;

---

&gt; .font140[**Minimum-Variance Frontier**]  
  &lt;br&gt;
  .font120[_Portfolios that provide the lowest possible risk for any given level    of expected return._]

--

&lt;img src="imgs/ret_risk.png" width="68%" style="display: block; margin: auto;" /&gt;

---
class: inverse, center, middle

# 2. `PortfolioAnalytics` &lt;sup&gt;.font60[v1.1.0]&lt;/sup&gt;

---
layout: true

### &gt;&gt; 2.1 Strengths

---

&gt; .font140[`PortfolioAnalytics` _is designed to provide numerical solutions and visualizations for portfolio optimization problems with complex constraints and objectives._]

--

.font130[

- Multiple and modular constraint and objective types

- An objective function can be any valid R function

- User defined moment functions (e.g., covariance matrix, return projections)

- Visualizations

- Solver agnostic

- Parallel computing

]

---
layout: true

### &gt;&gt; 2.2 Framework

---

&lt;img src="imgs/PA.svg" width="90%" style="display: block; margin: auto;" /&gt;

---
layout: true

### &gt;&gt; 2.3 Workflow

---

.full-width[.content-box-blue.bold.font120[Portfolio Specification]]

.code100[

```r
# install.packages("PortfolioAnalytics")
library(PortfolioAnalytics)
```
]

--

.code100[

```r
# portfolio.spec(assets = NULL, category_labels = NULL,
#                weight_seq = NULL, message = FALSE)

# eg., character vector of assets
portfolio.spec(assets = c("SP500", "FTSE100", "DAX", "CAC40"))

# eg., named vector of assets with initial weights
initial_weights &lt;- c("SP500" = 0.5, "FTSE100" = 0.3, "NIKKEI" = 0.2)
portfolio.spec(assets = initial_weights)

# eg., scalar of number of assets
portfolio.spec(assets = 4)
```
]

---

.full-width[.content-box-blue.bold.font120[Add Constraints]]

.code100[

```r
add.constraint(portfolio, type, enabled = TRUE,
               message = FALSE, ..., indexnum = NULL)
```
]

.code85[

```r
# type:
# 'weight_sum'|'leverage'|'weight' ('full_investment', 'dollar_neutral'|'active');
# 'box' ('long-only'); 'group'; 'turnover'; 'diversification'; 'position_limit'; 
# 'return'; 'factor_exposure'; 'leverage_exposure'
```
]

--

.code95[

```r
# initialize portfolio specification
p &lt;- portfolio.spec(assets = 4)

# eg., add full investment constraint (i.e., `type = "full_investment"`)
p &lt;- add.constraint(portfolio = p, type = "weight_sum", 
                    min_sum = 1, max_sum = 1)
# eg., add box constraint
p &lt;- add.constraint(portfolio = p, type = "box", 
                    min = 0.2, max = 0.6)
```
]

---

.full-width[.content-box-blue.bold.font120[Add Objectives]]

.code100[

```r
add.objective(portfolio, constraints = NULL, type, name,
              arguments = NULL, enabled = TRUE, ..., indexnum = NULL)

# type: 'return', 'risk', 'risk_budget', 'quadratic utility' or
#       'weight_concentration'
```
]

--

.code100[

```r
# initialize portfolio specification
p &lt;- portfolio.spec(assets = 4)

# eg., add mean return objective
p &lt;- add.objective(portfolio = p, type = "return", name = "mean")

# eg., add expected shortfall risk objective
p &lt;- add.objective(portfolio = p, type = "risk", name = "ES", 
                   arguments = list(p = 0.9, method = "gaussian")
```
]

---

.full-width[.content-box-blue.bold.font120[Run Optimizations]]

.code100[

```r
# Single period optimization
optimize.portfolio(
  R, portfolio = NULL, constraints = NULL, objectives = NULL, 
  optimize_method = c("DEoptim", "random", "ROI", "pso","GenSA"), 
  search_size = 20000, trace = FALSE, ..., rp = NULL, 
  momentFUN = "set.portfolio.moments", message = FALSE)
```
]

--

.code100[

```r
# Optimization with periodic rebalancing (backtesting)
optimize.portfolio.rebalancing(
  R, portfolio = NULL, constraints = NULL, objectives = NULL, 
  optimize_method = c("DEoptim", "random", "ROI"),
  search_size = 20000, trace = FALSE, ..., rp = NULL,
  rebalance_on = NULL, training_period = NULL, rolling_window = NULL)
```
]

---

.full-width[.content-box-blue.bold.font120[Run Optimizations: main options]]

.code110[
```
## R
   an xts, vector, matrix, data.frame, timeSeries or zoo object of  
   asset returns.

```
]

--

.code110[
```
## optimize_method

  - Global Solvers:
    - DEoptim: Differential Evolution Optimization
    - random: Random Portfolios Optimization, ?random_portfolios
    - GenSA: Generalized Simulated Annealing
    - pso: Particle Swarm Optimization
  
  - LP and QP Solvers:
    - ROI: R Optimization Infrastructure for linear and quadratic
           programming solvers

```
]

---

.full-width[.content-box-blue.bold.font120[Run Optimizations: main options]]

.code100[
```
## momentFUN: the name of a function to call to set portfolio moments

```
]

--

.code90[
```
+ Asset Return Moment Estimates Methods:
  - Sample
  - Shrinkage Estimators
  - Factor Model
  - Expressing Views
  - Robust Statistics
```
]

--

.pull-left.code90[
```
+ default:
  set.portfolio.moments(
    R, portfolio, momentargs = NULL, 
    method = c("sample", "boudt", 
               "black_litterman", "meucci"), 
    ...
  )
```
]

--

.pull-right.code90[
```
+ user-defined moment function:
  - Arguments
    - `R` for asset returns
    - `portfolio` for the portfolio 
       specification object
  - Return a named list of moments
    - `mu`: Expected returns vector
    - `sigma`: Variance-covariance matrix
    - `m3`: Coskewness matrix
    - `m4`: Cokurtosis matrix
```
]

---

.full-width[.content-box-blue.bold.font120[Analyze Results]]

.pull-left.code100[


```r
# data extraction
print()
summary()

extractObjectiveMeasures()
extractStats()
extractWeights()

# visualization
plot()
chart.Weights()
chart.EfficientFrontier()
chart.Concentration()
chart.RiskReward()
chart.RiskBudget()
```
]

--

.pull-right.code100[


```r
# compute portfolio returns and 
# table and chart with 
# PerformanceAnalytics
wts &lt;- extractWeights(opt)

Rp &lt;- Return.portfolio(
  R, 
  weights = wts
)

table.*(Rp)

charts.PerformanceSummary(Rp)
```
]


---
layout: false
class: inverse, center, middle

# 3. 案例

.font150[(_Case with `PortfolioAnalytics`_)]


---
layout: true

### &gt;&gt; 3.1 导入并处理 [{{全球指数数据}}](data/global_indexes.csv)

---


```r
# 加载必要的 R 包
library(tidyverse)
library(tidyquant)
library(PortfolioAnalytics)
```



.code100[

```r
# ... (导入与预处理代码从略)
# 注意：变量名及第二行和第三行的处理
#      缺失值填补
#      日期型变量
indexes
```

```
#&gt; # A tibble: 3,168 × 9
#&gt;   date         SPX  FTSE  FCHI GDAXI   N225    HSI `000300` SENSEX
#&gt;   &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1 2009-12-31 1115. 5413. 3936. 6048. 10655. 21872.    3576. 17465.
#&gt; 2 2010-01-04 1133. 5500. 4014. 6048. 10655. 21823.    3535. 17559.
#&gt; 3 2010-01-05 1137. 5522. 4013. 6032. 10682. 22280.    3564. 17686.
#&gt; 4 2010-01-06 1137. 5530. 4018. 6034. 10731. 22417.    3542. 17701.
#&gt; 5 2010-01-07 1142. 5527. 4025. 6019. 10682. 22269.    3471. 17616.
#&gt; # … with 3,163 more rows
```
]

---


```r
# 数据齐整：宽变长，方便下一步处理
indexes %&gt;% 
  pivot_longer(cols = -date, names_to = "symbol", values_to = "close") %&gt;% 
  arrange(symbol, date) %&gt;% 
  group_by(symbol) -&gt; indexes_l

# 基于日指数收盘点位，计算月度收益率数据
indexes_l %&gt;% 
  tq_transmute(
    select = close,
    mutate_fun = monthlyReturn
  ) %&gt;% 
  rename(return = monthly.returns) -&gt; idx_rets_l
idx_rets_l
```

```
#&gt; # A tibble: 1,248 × 3
#&gt; # Groups:   symbol [8]
#&gt;   symbol date        return
#&gt;   &lt;chr&gt;  &lt;date&gt;       &lt;dbl&gt;
#&gt; 1 000300 2009-12-31  0     
#&gt; 2 000300 2010-01-29 -0.104 
#&gt; 3 000300 2010-02-26  0.0242
#&gt; # … with 1,245 more rows
```

---
layout: true

### &gt;&gt; 3.2 探索性数据分析

---


```r
# 月度收益数据表长变宽，方便后续步骤
idx_rets_l %&gt;% 
  filter(row_number() != 1) %&gt;% 
  pivot_wider(names_from = symbol, values_from = return) -&gt; idx_rets_w

# 制表代码从略 ...
```

<div id="fhynnmuwwi" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#fhynnmuwwi .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fhynnmuwwi .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fhynnmuwwi .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#fhynnmuwwi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fhynnmuwwi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fhynnmuwwi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fhynnmuwwi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fhynnmuwwi .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fhynnmuwwi .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fhynnmuwwi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fhynnmuwwi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fhynnmuwwi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fhynnmuwwi .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#fhynnmuwwi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fhynnmuwwi .gt_from_md > :first-child {
  margin-top: 0;
}

#fhynnmuwwi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fhynnmuwwi .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fhynnmuwwi .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#fhynnmuwwi .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#fhynnmuwwi .gt_row_group_first td {
  border-top-width: 2px;
}

#fhynnmuwwi .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fhynnmuwwi .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fhynnmuwwi .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fhynnmuwwi .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fhynnmuwwi .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fhynnmuwwi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fhynnmuwwi .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fhynnmuwwi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fhynnmuwwi .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fhynnmuwwi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fhynnmuwwi .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fhynnmuwwi .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fhynnmuwwi .gt_left {
  text-align: left;
}

#fhynnmuwwi .gt_center {
  text-align: center;
}

#fhynnmuwwi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fhynnmuwwi .gt_font_normal {
  font-weight: normal;
}

#fhynnmuwwi .gt_font_bold {
  font-weight: bold;
}

#fhynnmuwwi .gt_font_italic {
  font-style: italic;
}

#fhynnmuwwi .gt_super {
  font-size: 65%;
}

#fhynnmuwwi .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#fhynnmuwwi .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fhynnmuwwi .gt_indent_1 {
  text-indent: 5px;
}

#fhynnmuwwi .gt_indent_2 {
  text-indent: 10px;
}

#fhynnmuwwi .gt_indent_3 {
  text-indent: 15px;
}

#fhynnmuwwi .gt_indent_4 {
  text-indent: 20px;
}

#fhynnmuwwi .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=" "> </th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="N">N</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Min">Min</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="P25">P25</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Mean">Mean</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Median">Median</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="P75">P75</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Max">Max</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="SD">SD</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Histogram">Histogram</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="" class="gt_row gt_left">000300</td>
<td headers="N" class="gt_row gt_right">155</td>
<td headers="Min" class="gt_row gt_right">-0.210</td>
<td headers="P25" class="gt_row gt_right">-0.046</td>
<td headers="Mean" class="gt_row gt_right">0.003</td>
<td headers="Median" class="gt_row gt_right">0.003</td>
<td headers="P75" class="gt_row gt_right">0.040</td>
<td headers="Max" class="gt_row gt_right">0.258</td>
<td headers="SD" class="gt_row gt_right">0.066</td>
<td headers="Histogram" class="gt_row gt_right">▂▃▇▄▁▁</td></tr>
    <tr><td headers="" class="gt_row gt_left">FCHI</td>
<td headers="N" class="gt_row gt_right">155</td>
<td headers="Min" class="gt_row gt_right">-0.172</td>
<td headers="P25" class="gt_row gt_right">-0.026</td>
<td headers="Mean" class="gt_row gt_right">0.005</td>
<td headers="Median" class="gt_row gt_right">0.003</td>
<td headers="P75" class="gt_row gt_right">0.037</td>
<td headers="Max" class="gt_row gt_right">0.201</td>
<td headers="SD" class="gt_row gt_right">0.049</td>
<td headers="Histogram" class="gt_row gt_right">▂▅▇▆▄</td></tr>
    <tr><td headers="" class="gt_row gt_left">FTSE</td>
<td headers="N" class="gt_row gt_right">155</td>
<td headers="Min" class="gt_row gt_right">-0.138</td>
<td headers="P25" class="gt_row gt_right">-0.020</td>
<td headers="Mean" class="gt_row gt_right">0.003</td>
<td headers="Median" class="gt_row gt_right">0.008</td>
<td headers="P75" class="gt_row gt_right">0.027</td>
<td headers="Max" class="gt_row gt_right">0.124</td>
<td headers="SD" class="gt_row gt_right">0.037</td>
<td headers="Histogram" class="gt_row gt_right">▁▂▄▇▄▂</td></tr>
    <tr><td headers="" class="gt_row gt_left">GDAXI</td>
<td headers="N" class="gt_row gt_right">155</td>
<td headers="Min" class="gt_row gt_right">-0.192</td>
<td headers="P25" class="gt_row gt_right">-0.021</td>
<td headers="Mean" class="gt_row gt_right">0.007</td>
<td headers="Median" class="gt_row gt_right">0.007</td>
<td headers="P75" class="gt_row gt_right">0.040</td>
<td headers="Max" class="gt_row gt_right">0.150</td>
<td headers="SD" class="gt_row gt_right">0.052</td>
<td headers="Histogram" class="gt_row gt_right">▁▂▃▇▆▄▁</td></tr>
    <tr><td headers="" class="gt_row gt_left">HSI</td>
<td headers="N" class="gt_row gt_right">155</td>
<td headers="Min" class="gt_row gt_right">-0.147</td>
<td headers="P25" class="gt_row gt_right">-0.029</td>
<td headers="Mean" class="gt_row gt_right">0.001</td>
<td headers="Median" class="gt_row gt_right">0.005</td>
<td headers="P75" class="gt_row gt_right">0.031</td>
<td headers="Max" class="gt_row gt_right">0.266</td>
<td headers="SD" class="gt_row gt_right">0.057</td>
<td headers="Histogram" class="gt_row gt_right">▁▂▄▇▅▂</td></tr>
    <tr><td headers="" class="gt_row gt_left">N225</td>
<td headers="N" class="gt_row gt_right">155</td>
<td headers="Min" class="gt_row gt_right">-0.117</td>
<td headers="P25" class="gt_row gt_right">-0.016</td>
<td headers="Mean" class="gt_row gt_right">0.008</td>
<td headers="Median" class="gt_row gt_right">0.013</td>
<td headers="P75" class="gt_row gt_right">0.039</td>
<td headers="Max" class="gt_row gt_right">0.150</td>
<td headers="SD" class="gt_row gt_right">0.051</td>
<td headers="Histogram" class="gt_row gt_right">▁▂▁▃▇▄▄▁▁</td></tr>
    <tr><td headers="" class="gt_row gt_left">SENSEX</td>
<td headers="N" class="gt_row gt_right">155</td>
<td headers="Min" class="gt_row gt_right">-0.231</td>
<td headers="P25" class="gt_row gt_right">-0.019</td>
<td headers="Mean" class="gt_row gt_right">0.010</td>
<td headers="Median" class="gt_row gt_right">0.008</td>
<td headers="P75" class="gt_row gt_right">0.041</td>
<td headers="Max" class="gt_row gt_right">0.144</td>
<td headers="SD" class="gt_row gt_right">0.049</td>
<td headers="Histogram" class="gt_row gt_right">▂▅▇▄▂▁</td></tr>
    <tr><td headers="" class="gt_row gt_left">SPX</td>
<td headers="N" class="gt_row gt_right">155</td>
<td headers="Min" class="gt_row gt_right">-0.125</td>
<td headers="P25" class="gt_row gt_right">-0.014</td>
<td headers="Mean" class="gt_row gt_right">0.009</td>
<td headers="Median" class="gt_row gt_right">0.015</td>
<td headers="P75" class="gt_row gt_right">0.034</td>
<td headers="Max" class="gt_row gt_right">0.127</td>
<td headers="SD" class="gt_row gt_right">0.043</td>
<td headers="Histogram" class="gt_row gt_right">▁▁▂▄▇▅▂▁</td></tr>
  </tbody>
  
  
</table>
</div>

---

.pull-left[

```r
# 用 ggplot2 绘制指数增长图，从略 ...
```

![](L12_Portfolio_files/figure-html/unnamed-chunk-23-1.png)&lt;!-- --&gt;
]

--

.pull-right.code85[

```r
# 绘制相关系数矩阵图
idx_rets_w %&gt;% select(-date) %&gt;% 
  cor() %&gt;% 
  corrplot::corrplot.mixed(
    upper ='ellipse', order ='hclust')
```

&lt;img src="L12_Portfolio_files/figure-html/unnamed-chunk-24-1.png" width="85%" style="display: block; margin: auto;" /&gt;
]

---
layout: true

### &gt;&gt; 3.3 基准投资组合

---

.code90[

```r
# PortfolioAnalytics 对 xts 数据的接受度更高
returns &lt;- idx_rets_w %&gt;% 
  timetk::tk_xts(select = -date, date_var = date)
head(returns, n = 5)
```

```
#&gt;             000300    FCHI    FTSE    GDAXI      HSI     N225   SENSEX     SPX
#&gt; 2010-01-29 -0.1039 -0.0500 -0.0414 -0.07267 -0.08003 -0.04287 -0.06338 -0.0370
#&gt; 2010-02-26  0.0242 -0.0082  0.0320 -0.00184  0.02419 -0.00706  0.00438  0.0285
#&gt; 2010-03-31  0.0195  0.0715  0.0607  0.09915  0.03060  0.09519  0.06684  0.0588
#&gt; 2010-04-30 -0.0832 -0.0395 -0.0222 -0.00290 -0.00616 -0.00293  0.00177  0.0148
#&gt; 2010-05-31 -0.0959 -0.0811 -0.0657 -0.02793 -0.06364 -0.11655 -0.03497 -0.0820
```

```r
# compute the benchmark returns with equal weights
# Naive diversification
equal_weights &lt;- rep(1 / ncol(returns), ncol(returns))

bnchmk_rets &lt;- returns %&gt;% 
  Return.portfolio(  # PerformanceAnalytics
    weights = equal_weights, rebalance_on = "quarters"
  )
colnames(bnchmk_rets) &lt;- "benchmark"   # default: "portfolio.returns"
```
]

---

.code75[

```r
# Benchmark performance
table.AnnualizedReturns(cbind(bnchmk_rets, returns))  # PerformanceAnalytics
```

```
#&gt;                           benchmark X000300   FCHI   FTSE  GDAXI     HSI   N225 SENSEX   SPX
#&gt; Annualized Return            0.0577  0.0058 0.0425 0.0263 0.0694 -0.0125 0.0776  0.104 0.106
#&gt; Annualized Std Dev           0.1336  0.2276 0.1686 0.1278 0.1791  0.1967 0.1751  0.170 0.150
#&gt; Annualized Sharpe (Rf=0%)    0.4322  0.0255 0.2521 0.2061 0.3878 -0.0634 0.4432  0.612 0.703
```
]

--

.code75[

```r
library(dygraphs)
cumprod(1 + cbind(bnchmk_rets, returns)) %&gt;% 
  dygraph(width = 1000, height = 300) %&gt;% dyRangeSelector()
```

<div id="htmlwidget-1f807e6fac8d36fe77ee" style="width:1000px;height:300px;" class="dygraphs html-widget"></div>
<script type="application/json" data-for="htmlwidget-1f807e6fac8d36fe77ee">{"x":{"attrs":{"labels":["month","benchmark","X000300","FCHI","FTSE","GDAXI","HSI","N225","SENSEX","SPX"],"legend":"auto","retainDateWindow":false,"axes":{"x":{"pixelsPerLabel":60}},"showRangeSelector":true,"rangeSelectorHeight":40,"rangeSelectorPlotFillColor":" #A7B1C4","rangeSelectorPlotStrokeColor":"#808FAB","interactionModel":"Dygraph.Interaction.defaultModel"},"scale":"monthly","annotations":[],"shadings":[],"events":[],"format":"date","data":[["2010-01-29T00:00:00.000Z","2010-02-26T00:00:00.000Z","2010-03-31T00:00:00.000Z","2010-04-30T00:00:00.000Z","2010-05-31T00:00:00.000Z","2010-06-30T00:00:00.000Z","2010-07-30T00:00:00.000Z","2010-08-31T00:00:00.000Z","2010-09-30T00:00:00.000Z","2010-10-29T00:00:00.000Z","2010-11-30T00:00:00.000Z","2010-12-31T00:00:00.000Z","2011-01-31T00:00:00.000Z","2011-02-28T00:00:00.000Z","2011-03-31T00:00:00.000Z","2011-04-29T00:00:00.000Z","2011-05-31T00:00:00.000Z","2011-06-30T00:00:00.000Z","2011-07-29T00:00:00.000Z","2011-08-31T00:00:00.000Z","2011-09-30T00:00:00.000Z","2011-10-31T00:00:00.000Z","2011-11-30T00:00:00.000Z","2011-12-30T00:00:00.000Z","2012-01-31T00:00:00.000Z","2012-02-29T00:00:00.000Z","2012-03-30T00:00:00.000Z","2012-04-27T00:00:00.000Z","2012-05-31T00:00:00.000Z","2012-06-29T00:00:00.000Z","2012-07-31T00:00:00.000Z","2012-08-31T00:00:00.000Z","2012-09-28T00:00:00.000Z","2012-10-31T00:00:00.000Z","2012-11-30T00:00:00.000Z","2012-12-31T00:00:00.000Z","2013-01-31T00:00:00.000Z","2013-02-28T00:00:00.000Z","2013-03-29T00:00:00.000Z","2013-04-26T00:00:00.000Z","2013-05-31T00:00:00.000Z","2013-06-28T00:00:00.000Z","2013-07-31T00:00:00.000Z","2013-08-30T00:00:00.000Z","2013-09-30T00:00:00.000Z","2013-10-31T00:00:00.000Z","2013-11-29T00:00:00.000Z","2013-12-31T00:00:00.000Z","2014-01-30T00:00:00.000Z","2014-02-28T00:00:00.000Z","2014-03-31T00:00:00.000Z","2014-04-30T00:00:00.000Z","2014-05-30T00:00:00.000Z","2014-06-30T00:00:00.000Z","2014-07-31T00:00:00.000Z","2014-08-29T00:00:00.000Z","2014-09-30T00:00:00.000Z","2014-10-31T00:00:00.000Z","2014-11-28T00:00:00.000Z","2014-12-31T00:00:00.000Z","2015-01-30T00:00:00.000Z","2015-02-27T00:00:00.000Z","2015-03-31T00:00:00.000Z","2015-04-30T00:00:00.000Z","2015-05-29T00:00:00.000Z","2015-06-30T00:00:00.000Z","2015-07-31T00:00:00.000Z","2015-08-31T00:00:00.000Z","2015-09-30T00:00:00.000Z","2015-10-30T00:00:00.000Z","2015-11-30T00:00:00.000Z","2015-12-31T00:00:00.000Z","2016-01-29T00:00:00.000Z","2016-02-29T00:00:00.000Z","2016-03-31T00:00:00.000Z","2016-04-29T00:00:00.000Z","2016-05-31T00:00:00.000Z","2016-06-30T00:00:00.000Z","2016-07-29T00:00:00.000Z","2016-08-31T00:00:00.000Z","2016-09-30T00:00:00.000Z","2016-10-31T00:00:00.000Z","2016-11-30T00:00:00.000Z","2016-12-30T00:00:00.000Z","2017-01-26T00:00:00.000Z","2017-02-28T00:00:00.000Z","2017-03-31T00:00:00.000Z","2017-04-28T00:00:00.000Z","2017-05-31T00:00:00.000Z","2017-06-30T00:00:00.000Z","2017-07-31T00:00:00.000Z","2017-08-31T00:00:00.000Z","2017-09-29T00:00:00.000Z","2017-10-31T00:00:00.000Z","2017-11-30T00:00:00.000Z","2017-12-29T00:00:00.000Z","2018-01-31T00:00:00.000Z","2018-02-28T00:00:00.000Z","2018-03-30T00:00:00.000Z","2018-04-27T00:00:00.000Z","2018-05-31T00:00:00.000Z","2018-06-29T00:00:00.000Z","2018-07-31T00:00:00.000Z","2018-08-31T00:00:00.000Z","2018-09-28T00:00:00.000Z","2018-10-31T00:00:00.000Z","2018-11-30T00:00:00.000Z","2018-12-28T00:00:00.000Z","2019-01-31T00:00:00.000Z","2019-02-28T00:00:00.000Z","2019-03-29T00:00:00.000Z","2019-04-30T00:00:00.000Z","2019-05-31T00:00:00.000Z","2019-06-28T00:00:00.000Z","2019-07-31T00:00:00.000Z","2019-08-30T00:00:00.000Z","2019-09-30T00:00:00.000Z","2019-10-31T00:00:00.000Z","2019-11-29T00:00:00.000Z","2019-12-31T00:00:00.000Z","2020-01-23T00:00:00.000Z","2020-02-28T00:00:00.000Z","2020-03-31T00:00:00.000Z","2020-04-30T00:00:00.000Z","2020-05-29T00:00:00.000Z","2020-06-30T00:00:00.000Z","2020-07-31T00:00:00.000Z","2020-08-31T00:00:00.000Z","2020-09-30T00:00:00.000Z","2020-10-30T00:00:00.000Z","2020-11-30T00:00:00.000Z","2020-12-31T00:00:00.000Z","2021-01-29T00:00:00.000Z","2021-02-26T00:00:00.000Z","2021-03-31T00:00:00.000Z","2021-04-30T00:00:00.000Z","2021-05-31T00:00:00.000Z","2021-06-30T00:00:00.000Z","2021-07-30T00:00:00.000Z","2021-08-31T00:00:00.000Z","2021-09-30T00:00:00.000Z","2021-10-29T00:00:00.000Z","2021-11-30T00:00:00.000Z","2021-12-31T00:00:00.000Z","2022-01-28T00:00:00.000Z","2022-02-28T00:00:00.000Z","2022-03-31T00:00:00.000Z","2022-04-29T00:00:00.000Z","2022-05-31T00:00:00.000Z","2022-06-30T00:00:00.000Z","2022-07-29T00:00:00.000Z","2022-08-31T00:00:00.000Z","2022-09-30T00:00:00.000Z","2022-10-31T00:00:00.000Z","2022-11-30T00:00:00.000Z"],[0.938589417504813,0.949826930032798,1.00951650290067,0.991800605543339,0.921697954941641,0.902586400254959,0.94962267329003,0.924768764245341,0.986910151449924,1.02589829959341,1.01248957062975,1.04970967324789,1.04821427848971,1.07067410946695,1.0596963389992,1.07887942506748,1.05330981085941,1.04909784308114,1.02220391495449,0.928651925003601,0.866401814347455,0.939499086354965,0.897695091628928,0.887787143401874,0.9446431280507,0.997902360190752,0.987305010644263,0.97970357631485,0.912418165016809,0.942065049714408,0.945548588911822,0.952803097248114,0.980602040194038,0.984308619251379,1.00232011712205,1.0482659729619,1.09665410844021,1.09263098237803,1.09696767991833,1.12027380497091,1.15237171687905,1.09201439553339,1.12854478863972,1.11297676124898,1.16356938577047,1.20122526991837,1.22864485673199,1.23599583054418,1.18561546037518,1.21735559598425,1.21319821597314,1.21798912237444,1.25106840036768,1.26151787360545,1.27758034556017,1.29293851062514,1.29080144287769,1.30463447314108,1.36501400416616,1.39091708673022,1.43425170826452,1.4959644672894,1.52182854591412,1.57522872299777,1.59055314974924,1.52797443214777,1.52071870585274,1.39056344024157,1.33389913495348,1.44410117300905,1.45512916364219,1.42669225986568,1.31057905143796,1.268130949677,1.34315871512842,1.34832392824931,1.36867179978868,1.34077494600437,1.40051725460751,1.42737064763944,1.41945058355073,1.43514038491313,1.4503363759638,1.47844764967205,1.51598854909446,1.53474011127066,1.56129242286705,1.57548225496672,1.61384505271199,1.61161377239508,1.6380944115713,1.64024446707499,1.6666274674229,1.7321964162667,1.73892224426313,1.76060214547701,1.8309630325351,1.74348457859119,1.69418925517558,1.74779595037369,1.7562917146286,1.72298632993724,1.76355786417769,1.74235821022331,1.75006477120723,1.62257292698599,1.64264615887096,1.54934946360135,1.63648671046776,1.70149816130224,1.74556819384102,1.80344441773625,1.70351850003249,1.78076710083904,1.77030879143128,1.72134177550542,1.77015462304983,1.8111142549338,1.83456076172651,1.88764570785536,1.89017014800652,1.71854984098368,1.483782497441,1.59834177667956,1.62514028295534,1.7020316248135,1.73733214349031,1.80442950779458,1.75262117665684,1.72376895805306,1.93655280581501,2.01198076900249,2.00577822675416,2.06793424875565,2.11124738844237,2.14615738221003,2.1945958328239,2.19960848725188,2.14740189354326,2.19959909916286,2.17962944543465,2.23180172847706,2.16183370055635,2.23864454912131,2.16008372089656,2.11383402029693,2.11925300458675,2.04616814655102,2.05715844123896,1.98030081987678,2.04495118068397,2.00717070378147,1.86431485333564,1.90787556989584,2.06476088574607],[0.896095684070516,0.91777293519226,0.935655108225447,0.857840066404078,0.775589789254308,0.716805511896465,0.802320898602896,0.81192521486798,0.820982502928111,0.94526893316076,0.877310467032321,0.874870654118205,0.860397059695431,0.905997006446878,0.90144654840864,0.892898533539317,0.839435475841825,0.851330542631843,0.831191738419838,0.796148652957028,0.721918100145315,0.753787806752498,0.70518535754278,0.656026091791109,0.68917163820964,0.736682268343623,0.686553677562111,0.734448849506835,0.73609468845681,0.688431080598845,0.652440763781139,0.616628315030075,0.641305551609146,0.63059822959747,0.598392083864234,0.705585840359495,0.751431614203045,0.747640731116061,0.697791807105997,0.684430167766503,0.728930744439385,0.61544560425362,0.613315102788725,0.647123739122361,0.673727600089941,0.663850049389152,0.682091594223651,0.651630848811025,0.615952080776713,0.609385784649874,0.600250189893738,0.603705193188212,0.603091324624883,0.605511560864998,0.65728710926357,0.65394117600996,0.685459900818976,0.701495154493518,0.785533341313158,0.988259868601364,0.960484763194958,0.999205466702315,1.13298714315918,1.32838528236835,1.35381901756419,1.25094879748882,1.06740397082069,0.941508226118415,0.895757986443992,0.988364408040531,0.997406985628484,1.04343803870812,0.823923534630017,0.804731793972845,0.899992253230431,0.882836710402821,0.886420556178901,0.882046903473573,0.896032870913649,0.930673348092281,0.909835656618426,0.93304604098125,0.989461317051506,0.925719610569614,0.947500002796667,0.96563630902507,0.96654108696406,0.961984616090236,0.976843731157451,1.02548147431373,1.04535892992781,1.06891235355249,1.07294193222891,1.12054585919785,1.12037285733303,1.1272961760603,1.19582675650309,1.12527882777113,1.09028026525834,1.05067352148568,1.06339819178652,0.981905699720669,0.983771720319805,0.932549856195346,0.961736244030513,0.88201960799668,0.88729596910689,0.841979772261755,0.895390392439601,1.02620094504995,1.08296516135095,1.09439508636669,1.01513145456925,1.06988964908532,1.07262244090921,1.06261803336089,1.0667967862932,1.08699535529426,1.07075194564173,1.14567788988065,1.11975814976939,1.10190072724547,1.03089509587536,1.09421783356695,1.08147789346038,1.16452228440768,1.31304841255547,1.34693538355179,1.28294203290895,1.31312884471894,1.38721763444421,1.45742422988161,1.49676666058858,1.4925146908955,1.41185873807641,1.43286962718182,1.49106285678488,1.46099068038451,1.34552424095642,1.34396940557387,1.36096551037508,1.37281988564985,1.35135711097513,1.38165825056129,1.27633538086699,1.28133411677318,1.1809200141847,1.12320915382903,1.14426151751665,1.25430849034758,1.16623893498419,1.14071606998829,1.0640999875828,0.981267751848318,1.07756627822817],[0.949986408659843,0.942197427553076,1.00957236817035,0.969682419919062,0.891073665063651,0.874644656316925,0.925516915502511,0.886813351522865,0.94381822662226,0.973876682087122,0.917209685163592,0.966580545838383,1.01757220558236,1.04420869185256,1.01342621172513,1.04333732182007,1.01793802856976,1.01165552684861,0.933044231555789,0.827359494757808,0.757548274661931,0.823823205879588,0.801411467026393,0.802729954043487,0.837975982704702,0.877073314483288,0.869797501733849,0.829775450737108,0.766452507792792,0.812088925471188,0.83622562132748,0.867069071952809,0.852271024024917,0.871184580561081,0.903704719878669,0.924991044958121,0.948243668594859,0.945804848678846,0.947943896980182,0.967919356354777,1.00311457626774,0.949846684602155,1.01431790525693,0.999352188459809,1.05261499925057,1.09236014256935,1.09117121786029,1.09135921022882,1.06190791930555,1.11984513493533,1.11563308970539,1.13999334405398,1.14816847164745,1.1235948205562,1.07870529147709,1.1129757921719,1.12191813186394,1.07539002065376,1.11529775196693,1.08546539543179,1.16968089565661,1.25789250393133,1.27876473771254,1.28202919978762,1.27222311137532,1.21692032934231,1.29120525972162,1.18205282585556,1.13183853995981,1.24421986977718,1.25944725162779,1.17801607080707,1.12211628598212,1.1059921297249,1.11399704801173,1.12514956825266,1.14462456145699,1.07650527267785,1.12790594284524,1.12750201329665,1.13005261245881,1.14554928067515,1.16309862232079,1.23523942352394,1.23649185916831,1.23429184036908,1.30134160499755,1.33813221960557,1.34227313258797,1.30087670495106,1.29404038787398,1.29196231007055,1.35400487255896,1.39807638079125,1.36492367255794,1.34962261802237,1.39265000647812,1.35163718489049,1.3127202241682,1.39297010159209,1.37142973277139,1.3524094778639,1.40011127115867,1.37357640238496,1.39558675212698,1.29395655343937,1.27121455772255,1.18860461394243,1.26836926782053,1.33132384734004,1.35926865887769,1.41919249656406,1.32296580825287,1.40714066147909,1.40204200359218,1.3922816430533,1.44240701363961,1.45563507124657,1.50017147952535,1.51868872782516,1.51709587356751,1.34894686167064,1.11680677178997,1.16153371287468,1.19284714442133,1.25395736637934,1.21526650458676,1.2568102775936,1.22028386847648,1.16713791780669,1.40195308828274,1.41030096562026,1.3716355082018,1.44886734597963,1.54134180823254,1.59272215490063,1.63786318728359,1.6532734806279,1.6799302903974,1.69705791943257,1.65636773339634,1.73520512761888,1.70746863194905,1.81718250248328,1.76963821630809,1.69163408555685,1.69189829104775,1.65986337527596,1.64335815340686,1.50466551330808,1.63820106545945,1.55604331953876,1.46388641196241,1.59203369636184,1.71188645260941],[0.958550716069819,0.989218308922422,1.04928245222506,1.02593998019539,0.958534089061646,0.908364863067351,0.971390461270156,0.965330840513738,1.02507722321574,1.04845479670711,1.02131767192326,1.0899816733421,1.08314612553761,1.1073605917737,1.09161112014307,1.12138085455432,1.10661791874196,1.0984374307208,1.0743245739791,0.996609937778041,0.94745865417301,1.02426434726061,1.01709625929265,1.02944827891991,1.04964639895952,1.08472938620476,1.06568961440121,1.06728950207653,0.982999807865684,1.02923951759507,1.04108718464108,1.05516471822763,1.06081605356114,1.06832222402861,1.0838629343344,1.08958816748201,1.15961927846174,1.17512488730583,1.18453392648645,1.18724597626402,1.21618990260268,1.14827411655163,1.22320465260638,1.18475377248341,1.19385983062621,1.24359490696265,1.2286564638418,1.24685749545528,1.20794290654882,1.25805486173719,1.2190127991014,1.25257349137613,1.26448581900947,1.24590606109871,1.24335104417611,1.25991154431652,1.2235113285349,1.20942455772158,1.24196730760704,1.21304924550332,1.24691476626121,1.28335747328594,1.25128212707468,1.28593835444348,1.29033527438258,1.20471541951789,1.23710113654838,1.15427277161142,1.11984932235704,1.17517661577571,1.17425289309942,1.15323450732327,1.12394695614904,1.12640405846795,1.14077903075627,1.15315506717311,1.15110440283176,1.20163942300587,1.24230169521586,1.2528469132883,1.27461351443224,1.28475414197248,1.25326813082869,1.31959880876724,1.32304614179513,1.34188084716454,1.35286945212161,1.33088854731677,1.38926966790322,1.35098505786199,1.361936713912,1.37276643856875,1.3620771197588,1.38430558224088,1.35356224412882,1.42027349580999,1.39178219358271,1.3360558519679,1.30367013493741,1.38599229984777,1.41850549060759,1.41088108363755,1.4315410650153,1.37309897873221,1.38746840868447,1.31687752176291,1.28956119477986,1.2440641580822,1.28745695452328,1.30701770591626,1.34479057359483,1.37047560633156,1.32308678559288,1.37184456333782,1.40161614519442,1.331487119611,1.36862631353365,1.33909859446358,1.35723127059902,1.39342457250114,1.38700100501027,1.21573173615524,1.04786361419429,1.09021629890188,1.12261864294054,1.13982574895435,1.08957893025524,1.10173696812048,1.08372991826902,1.03037015415084,1.15764435937985,1.19354576491627,1.18374321987556,1.197778262219,1.24030645423508,1.28763430927713,1.29738882073868,1.3001341245326,1.29917899528532,1.31532566766675,1.30917736953341,1.33710150603745,1.30419480941754,1.36425341038412,1.37931563234359,1.37787093007789,1.38848080873768,1.39381438347054,1.40547361109058,1.32448530172477,1.37143812536025,1.34570690648971,1.27359372459763,1.31067564771434,1.39907960272535],[0.92733330026619,0.925625382338839,1.01740158391614,1.01445034141825,0.986116760081345,0.986313509581205,1.01647901063109,0.97965048030025,1.02987947026437,1.09144222343468,1.10584627085297,1.1431625415406,1.17016021030703,1.20237422085545,1.16418001752559,1.24240861068399,1.20590744506721,1.21955590827175,1.18360035051171,0.956442306102541,0.909680406064514,1.01538283484616,1.00670270985236,0.975207909660566,1.06788849759437,1.13355488319032,1.14855909925103,1.1245010994825,1.03572574111734,1.0608402360994,1.11969644362879,1.15252054296249,1.19308731379065,1.20044144635683,1.22439363126829,1.25859993717243,1.2856587801531,1.27997949837144,1.28884314600797,1.29205892564853,1.38036142387117,1.31594332291718,1.36831341037978,1.33974009225733,1.42096126184217,1.49362961493312,1.55503199246069,1.57931319544335,1.54977101003588,1.60244696856968,1.57993320437148,1.58775689036589,1.64397764661144,1.62575765091017,1.55539242431758,1.56575732023874,1.56644015673826,1.54206471239852,1.65019096274986,1.62120761205628,1.76815303473703,1.88510159879636,1.97843526280112,1.89381809764727,1.88711208108063,1.80959443149315,1.86977993816444,1.6962551460741,1.59721574657342,1.79391564571863,1.88188912587008,1.77620323065985,1.61997751434287,1.56992874030719,1.64765471289453,1.65980027445728,1.69679744721657,1.60046459335681,1.70915794520774,1.75134996610618,1.73784699833011,1.76330704495478,1.7592215994577,1.89822925450126,1.95900170295785,1.95665062910239,2.03575715490303,2.05644726617397,2.08571995436734,2.03778251740158,2.00357951821173,1.99326091629053,2.12106873005638,2.18732040408048,2.15332903460476,2.13574723476018,2.1806920952995,2.05609014103136,2.00002149364284,2.08006712629995,2.08403849015426,2.0346212985467,2.11720648777342,2.04422069011127,2.02482185076798,1.89268224129094,1.86122381495627,1.7457731924673,1.8473124679662,1.90394656349718,1.90566605492452,2.0409172825422,1.93886546632938,2.04996445282145,2.01528363341765,1.97398938544715,2.05480548253228,2.12733991369476,2.18844634029397,2.1905345303639,2.21358398227601,1.96589950895293,1.64274920225518,1.79581700643156,1.91572011970306,2.03543640361754,2.03583816940297,2.14033364747119,2.10980440785014,1.91136517699188,2.19750343071607,2.26820428880842,2.22093315477076,2.27936610287188,2.48141461237042,2.50250648942678,2.54966354182167,2.56783559016583,2.57004282194997,2.61810591405849,2.52313707984061,2.59391399236149,2.49659077757386,2.62633467255262,2.53276953854802,2.3909230692922,2.38327298579766,2.33088305804937,2.37890812294364,2.11361374270456,2.22939503662186,2.1220772779128,2.00293636228362,2.19131656829192,2.38034489029975],[0.919967548291233,0.942219645673791,0.971052673448394,0.965074399359927,0.903654794833695,0.920287584866842,0.961472648302663,0.938918285518345,1.02220459023888,1.05595245170877,1.05191404731969,1.0531695050863,1.07200091439022,1.06700285746943,1.07566670476626,1.08450382900903,1.08282683735284,1.02403017487713,1.0259572522574,0.938843296376729,0.804316379014745,0.908212138530118,0.822464281632186,0.842811292719168,0.932243227797463,0.991202651731627,0.939791061835639,0.948288947308264,0.851732540861813,0.888854040461767,0.905100468624986,0.890733569550806,0.95281197851183,0.989453423248371,1.00721865356041,1.0358632986627,1.08490250314322,1.05247548291233,1.01952817464853,1.0308702708881,1.02375860098297,0.951116241856212,1.00051022974054,0.993547605440622,1.04514161618471,1.06098388387244,1.09184089610241,1.06555674934278,1.00744862269974,1.04409463938736,1.01273562692879,1.0119542804892,1.05528174648531,1.0602683735284,1.13187107097954,1.13119487941479,1.04848462681449,1.09717956337867,1.09669447936907,1.07921088124357,1.12045033718139,1.13490867527717,1.13845650931535,1.28622699737113,1.25382055092011,1.20013853011773,1.12635866956224,0.990768316379015,0.953082638015773,1.03509155332038,1.00566556177849,1.00191564750257,0.899902160246885,0.873788090067436,0.949900560064007,0.963175220025146,0.951655732083667,0.950708423819865,1.00086272716882,1.05049171333867,1.06513430106298,1.04855594925134,1.04193713567265,1.00585484055321,1.06865561778489,1.08541456166419,1.10237009943994,1.12539170190879,1.1731923648417,1.17794399359927,1.24923945593782,1.27878843296377,1.25976911647045,1.2913722711167,1.3339741684764,1.36788890158875,1.50358989598811,1.41020550920105,1.37585461195565,1.38441741913362,1.39300765801806,1.32381346439593,1.30680123442679,1.27505086295577,1.27047754029032,1.14205920676649,1.21187564293062,1.16603954737684,1.27751605897817,1.30909498228369,1.32821396731055,1.35782878043205,1.22990467481998,1.30495462338553,1.26998514115899,1.17612207109384,1.19292582009373,1.23016207566579,1.20454863412962,1.2888215796091,1.27599131329295,1.1946476168705,1.07913955880672,1.12669287918619,1.04978717567722,1.11679917704881,1.12448736998514,1.15108240941822,1.0725362898617,1.1021794490799,1.20432003657561,1.24499394216482,1.29311738484398,1.32496102411704,1.29744427934621,1.31328746142416,1.33280603497543,1.31799977140245,1.18692559149617,1.18317476283004,1.12358623842725,1.16023499828552,1.07327740313179,1.06973002628872,1.07669813692994,1.03842816321865,1.00568522116813,0.964196593896446,0.979092467710596,0.999418905017717,0.92154577666019,0.912304949137044,0.787419362212825,0.671483369527946,0.850256257858041],[0.957131956612941,0.950373493987211,1.04084078616284,1.03778676069636,0.916836465101612,0.880602996398803,0.895118533542191,0.828177749162583,0.879355670078904,0.863691353841793,0.932635931820336,0.960030183607561,0.96087487411765,0.997118666815583,0.915560043886365,0.924442433872465,0.909800193152563,0.92128422990974,0.922874125158732,0.840485828439603,0.816561377558826,0.843600859331812,0.791626113700974,0.793572656054226,0.826155184663424,0.912569839480647,0.946387493324599,0.893578381178794,0.801773662362187,0.845326843607429,0.816070518517963,0.829665343005353,0.832504441664266,0.837960203814435,0.886550556134847,0.975634432963954,1.04541337745746,1.08489796607911,1.1635996579942,1.30308809465039,1.29280257987253,1.28367804527353,1.28283335476344,1.25660477588014,1.35674189730628,1.34474166079294,1.4699369954734,1.52901277265906,1.4084801295943,1.39290122095321,1.39165858735836,1.34250510803122,1.37331472511425,1.42303133144811,1.46607957547732,1.44766719944739,1.517957650972,1.54050525632134,1.6386855113991,1.63783331252892,1.65882105606962,1.76427128080422,1.8026624644878,1.83204080042873,1.92994418472818,1.89921434397112,1.93201743065795,1.77295657633797,1.63195614366872,1.79103483034391,1.85338894525373,1.78639935653354,1.64417130698963,1.50418356438747,1.57287661230301,1.56418380840918,1.617580449732,1.46187020110204,1.55510056979068,1.58495850223233,1.54389152672178,1.63541655912505,1.71833325668549,1.79396966059397,1.82100163400686,1.79440326838915,1.77471916386902,1.80170045585131,1.8442944440951,1.88022757839432,1.87006782864796,1.84388805410524,1.91052850408126,2.06588867542204,2.13283978379677,2.13659208675159,2.16787848470031,2.07120365582053,2.01358262340224,2.10871073010355,2.08374074008028,2.09337865880041,2.1167681390248,2.14599724630894,2.26377432122078,2.05733383764485,2.09774758582759,1.8784762534034,1.94968554049399,2.00709352319473,1.99026071841866,2.08908199973908,1.93351440995083,1.99684085749226,2.01989246151262,1.9431983173765,2.0418835096703,2.15180590138332,2.18623830220962,2.22028026831125,2.23330915015688,1.9843619630232,1.77544653625271,1.89526870074398,2.05333845153213,2.09184226061706,2.03758121933891,2.1717706308618,2.17602787103265,2.15650707334448,2.48091421792452,2.57575888403244,2.59633366776821,2.71859041801856,2.73856171731212,2.70419501463661,2.70864841071481,2.70221468466296,2.56068772824242,2.63632976342096,2.76426471098914,2.71170900599637,2.61119740511075,2.70223157847316,2.5075426169826,2.48966145742901,2.61116643312538,2.51979626064897,2.56033201968317,2.47710560226903,2.6093090525482,2.63651653387819,2.434323905023,2.58920729549808,2.62501560331081],[0.936623988465949,0.940723088313013,1.00360496335202,1.00537652571084,0.970215536269791,1.01351803999013,1.02310245573814,1.02899029534246,1.14911756841328,1.14701161936488,1.11774763080732,1.17430936838133,1.04941078660461,1.02053214435199,1.11339430546339,1.09547656115354,1.05946070985026,1.0790767262856,1.04193518280474,0.954877264625266,0.942109304366895,1.01375337034872,0.923196988687538,0.884917728850185,0.984468196333083,1.01648285896039,0.996529592935738,0.981072797241997,0.928640506252287,0.998005704041441,0.98690910465101,0.997981655683629,1.07431686917865,1.05958095163933,1.10736389345203,1.11233445997981,1.13914666120044,1.07997395906397,1.07849842053821,1.10431891328907,1.13143515446203,1.11056518794078,1.10769598982182,1.06612783076369,1.10964676970434,1.21183797590698,1.19050421962793,1.21219068515489,1.1736886917178,1.20929572093828,1.28179293104248,1.28359827561823,1.38663632756383,1.45514208285117,1.48269405736449,1.52524476361323,1.52480960285282,1.59554154897763,1.64296032994347,1.57456164710638,1.67095719907631,1.67308547874268,1.60078981678014,1.54661344726911,1.59340067255241,1.59067461942042,1.60978333002191,1.50491703030265,1.4975731198908,1.52631663327571,1.49704863665852,1.49543796926505,1.42404583846031,1.31704839617494,1.45102408786583,1.46618371456661,1.52695391475773,1.54594982710948,1.60619325374854,1.62911420164319,1.59554899251695,1.59922781868225,1.52608645613665,1.52457770797392,1.58651253577909,1.64578486682649,1.69601043469697,1.71306759134511,1.78334605415118,1.77050938429906,1.86174026513887,1.81682423112533,1.79124307679271,1.90171722452177,1.89806530961402,1.95002579472665,2.05928492780626,1.95730958424397,1.88772050769519,2.00229490043121,2.02248865003398,2.02827743330732,2.15327736173483,2.21273921674499,2.07429339340079,1.97208271947991,2.07241304085186,2.06568064582437,2.07598536714685,2.05369769267458,2.21433327931996,2.23486828657168,2.27395545671553,2.25565809190023,2.14609377370839,2.13760069534109,2.21401377970903,2.29770893585444,2.33577176047149,2.36210643001556,2.36970227560449,2.19282603131669,1.68730664690884,1.93060331031371,1.85653894889209,1.99920869451199,2.15329511171321,2.2117784275924,2.1796933376315,2.26822221369714,2.52792443776944,2.73414540438745,2.65023037754204,2.81136697164183,2.83479465279038,2.79318011475647,2.97383366896061,3.00505473578012,3.01101701077767,3.29533444681047,3.38545681287114,3.39579588899049,3.26742002919013,3.33549692209649,3.27517047136499,3.22060646522922,3.35351544047717,3.26719099721096,3.1816212143161,3.03575819032672,3.29635707459743,3.40897324391161,3.28815028620409,3.47822793377082,3.60075317166348],[0.963025737602009,0.990485158281769,1.04872208770514,1.06420052013272,0.976961707470182,0.924320688727468,0.987893462469734,0.941018742713658,1.02340597255851,1.06112456281948,1.05869428750785,1.12782710070846,1.15336741099453,1.19022509192001,1.18897856694467,1.22285893641826,1.20634920634921,1.1843242758497,1.15889157923056,1.0930768540938,1.01463545870326,1.12393507308762,1.11824948435118,1.12779122948614,1.17694377185903,1.2247152721729,1.26308851224105,1.25850596359071,1.17507846829881,1.22155860460945,1.23694735898126,1.26139359698682,1.29196484620213,1.26639763249933,1.27000269034167,1.27897946372523,1.34347592144202,1.35833557528473,1.40721908349027,1.41892206976953,1.46241592682271,1.44048067437898,1.51172988969599,1.46441574746659,1.5079813469644,1.57523092099363,1.61941529907632,1.6575733118106,1.60899470899471,1.66751860819657,1.67907810958658,1.68948973186261,1.72502017756255,1.75789615281141,1.73138731952291,1.79658326607479,1.76871132633844,1.80974800466326,1.85414761007981,1.84638149044929,1.78906824500045,1.88727468388485,1.85444354766389,1.87024482109228,1.88986637969689,1.85015693659761,1.88668280871671,1.76861268047709,1.72184557438795,1.86472962066182,1.86567124024751,1.83296565330464,1.73996950946103,1.73278629719308,1.84713478611784,1.85212088601919,1.88051295847906,1.88221684153887,1.94924222042866,1.9468657519505,1.9444623800556,1.90668998296117,1.97185005829074,2.00773921621379,2.05961797148238,2.1196663976325,2.11884135951932,2.13810420590082,2.16285534929603,2.17326697157206,2.21531701192718,2.21652766568021,2.25931306609273,2.30944309927361,2.37429826921352,2.39764146713299,2.53233790691418,2.43370998116761,2.3682808716707,2.39432337906914,2.42603353959286,2.43778136490001,2.52559411711954,2.60202672406062,2.61320060981078,2.43183570980181,2.47526679221595,2.22916330373958,2.42498430634024,2.49707649538158,2.54183481302125,2.64176307057663,2.46799390189221,2.63811317370639,2.67274683884853,2.62439243117209,2.66948255761815,2.7240247511434,2.81676979643081,2.89730069052103,2.98227961617792,2.64928705945655,2.31781006187786,2.61181059994619,2.73007801990853,2.78027979553403,2.93347681822258,3.13900995426419,3.01587301587302,2.93243655277554,3.24780737153619,3.36837054972648,3.33085821899381,3.41776522284997,3.56281051026814,3.7495919648462,3.77016411084208,3.85391444713479,3.94158371446507,4.05585149313963,3.86291812393508,4.13001524526948,4.09559680746122,4.27421755896332,3.97439691507488,3.92246435297283,4.06278360685141,3.70543449018026,3.70563178190297,3.39465518787553,3.70396377006547,3.54676710608914,3.2155143036499,3.47231638418079,3.65896332167519]]},"evals":["attrs.interactionModel"],"jsHooks":[]}</script>
]

---
layout: true

### &gt;&gt; 3.4 投资组合优化（基础版）

---

.code90[

```r
# Base portfolio specification
(portfolio.spec(assets = colnames(returns)) %&gt;% 
* add.constraint(type = "full_investment") %&gt;%
* add.constraint(type = "long_only") %&gt;%
* add.objective(type = "risk", name = "StdDev") -&gt; base_ps)
```
]

--

.code70[

```
#&gt; **************************************************
#&gt; PortfolioAnalytics Portfolio Specification 
#&gt; **************************************************
#&gt; 
#&gt; Call:
#&gt; portfolio.spec(assets = colnames(returns))
#&gt; 
#&gt; Number of assets: 8 
*#&gt; Asset Names
#&gt; [1] "000300" "FCHI"   "FTSE"   "GDAXI"  "HSI"    "N225"   "SENSEX" "SPX"   
#&gt; 
*#&gt; Constraints
#&gt; Enabled constraint types
#&gt; 		- full_investment 
#&gt; 		- long_only 
#&gt; 
*#&gt; Objectives:
#&gt; Enabled objective names
#&gt; 		- StdDev
```
]

---

.code90[

```r
# Run the optimization with periodic rebalancing
# install.packages(c("ROI", "ROI.plugin.glpk", "ROI.plugin.quadprog"))
opt_base &lt;- optimize.portfolio.rebalancing(
  R = returns,
  portfolio = base_ps,
* optimize_method = "ROI",
  rebalance_on = "quarters",
  training_period = 60,      # 60 months
  rolling_window = 60        # 60 months
)
# Calculate portfolio returns
base_rets &lt;- Return.portfolio(returns, extractWeights(opt_base))
colnames(base_rets) &lt;- "base"
```
]

--

.code90[

```r
# Compare annualized performance
table.AnnualizedReturns(cbind(bnchmk_rets, base_rets) %&gt;% na.omit())
```

```
#&gt;                           benchmark   base
#&gt; Annualized Return            0.0512 0.0331
#&gt; Annualized Std Dev           0.1377 0.1263
#&gt; Annualized Sharpe (Rf=0%)    0.3716 0.2619
```
]

---
  
.code90[

```r
# chart.Weights(opt_base)
library(plotly)
extractWeights(opt_base) %&gt;% 
  timetk::tk_tbl(rename_index = "date") %&gt;% 
  tidyr::pivot_longer(cols = -date, names_to="index", values_to="weights") %&gt;% 
  plot_ly(x=~date, y=~weights, color=~index, type="bar", height=320) %&gt;%
  layout(barmode = "stack", xaxis = list(title = ""),
         yaxis = list(title = "Weights(%)", tickformat = ".0%"))
```

<div id="htmlwidget-7a516989b942b94445f6" style="width:80%;height:320px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-7a516989b942b94445f6">{"x":{"visdat":{"312031d532c2":["function () ","plotlyVisDat"]},"cur_data":"312031d532c2","attrs":{"312031d532c2":{"x":{},"y":{},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"layout":{"height":320,"margin":{"b":40,"l":60,"t":25,"r":10},"barmode":"stack","xaxis":{"domain":[0,1],"automargin":true,"title":""},"yaxis":{"domain":[0,1],"automargin":true,"title":"Weights(%)","tickformat":".0%"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["2014-12-31","2015-03-31","2015-06-30","2015-09-30","2015-12-31","2016-03-31","2016-06-30","2016-09-30","2016-12-30","2017-03-31","2017-06-30","2017-09-29","2017-12-29","2018-03-30","2018-06-29","2018-09-28","2018-12-28","2019-03-29","2019-06-28","2019-09-30","2019-12-31","2020-03-31","2020-06-30","2020-09-30","2020-12-31","2021-03-31","2021-06-30","2021-09-30","2021-12-31","2022-03-31","2022-06-30","2022-09-30","2022-11-30"],"y":[0.0713549124914046,0.0946954164455659,0.083205841648239,0.0788805186323856,0.084771587950205,0.0427853764491762,0.0428100861568233,0.0374072395950484,0.0423588634075171,0.0488261042760531,0.0323689895467835,0.0182560723145294,0.0196116983649663,0.0148408930236763,0.0146239927529671,0.018138911542355,0.025575779655904,0.0151035613882589,0.0194306037973146,0.0177661361357614,0.0214351976803781,0.0926923405241761,0.135785363488264,0.193891973559084,0.266632506936123,0.368308719236765,0.385958794708323,0.370993770867405,0.379882311805303,0.346048150951837,0.340626011322175,0.332126093609917,0.309607799205872],"type":"bar","name":"000300","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2014-12-31","2015-03-31","2015-06-30","2015-09-30","2015-12-31","2016-03-31","2016-06-30","2016-09-30","2016-12-30","2017-03-31","2017-06-30","2017-09-29","2017-12-29","2018-03-30","2018-06-29","2018-09-28","2018-12-28","2019-03-29","2019-06-28","2019-09-30","2019-12-31","2020-03-31","2020-06-30","2020-09-30","2020-12-31","2021-03-31","2021-06-30","2021-09-30","2021-12-31","2022-03-31","2022-06-30","2022-09-30","2022-11-30"],"y":[-3.65837965435064e-17,7.04343185824975e-17,4.92442380033921e-17,0,0,-1.5145975254364e-19,0,0,-4.26434817192847e-18,7.00768396595823e-18,0,0,0,0,0,-1.08243837198615e-20,0,1.7988522298158e-18,-1.70991800088497e-17,1.42912485650097e-17,2.16761260551245e-17,2.00456325551109e-17,2.27825960299361e-17,4.87595736475632e-18,-6.16146283743393e-19,5.88917422368555e-18,-5.88215690133204e-17,6.12431955747017e-18,-4.93938488191299e-17,-4.35049646839839e-17,7.65092289257697e-18,5.99430907752273e-17,2.03149800650978e-16],"type":"bar","name":"FCHI","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2014-12-31","2015-03-31","2015-06-30","2015-09-30","2015-12-31","2016-03-31","2016-06-30","2016-09-30","2016-12-30","2017-03-31","2017-06-30","2017-09-29","2017-12-29","2018-03-30","2018-06-29","2018-09-28","2018-12-28","2019-03-29","2019-06-28","2019-09-30","2019-12-31","2020-03-31","2020-06-30","2020-09-30","2020-12-31","2021-03-31","2021-06-30","2021-09-30","2021-12-31","2022-03-31","2022-06-30","2022-09-30","2022-11-30"],"y":[0.512196314878897,0.472534011271947,0.361775727510152,0.352262720076955,0.359441772272534,0.590221700611219,0.549150740980482,0.556550943857146,0.407348558000684,0.383552629147259,0.373219668556374,0.388604658347077,0.337693176430825,0.425421278805127,0.378102929141559,0.437242418660647,0.517969864009847,0.54316357897918,0.559099999981025,0.52185814202229,0.523350606524636,0.568171968825892,0.702825719157699,0.746708774750757,0.704211896886849,0.612135285122447,0.555759859461853,0.605744943133293,0.590406404117751,0.618914711819122,0.630011211563159,0.626178205530633,0.585666518166166],"type":"bar","name":"FTSE","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2014-12-31","2015-03-31","2015-06-30","2015-09-30","2015-12-31","2016-03-31","2016-06-30","2016-09-30","2016-12-30","2017-03-31","2017-06-30","2017-09-29","2017-12-29","2018-03-30","2018-06-29","2018-09-28","2018-12-28","2019-03-29","2019-06-28","2019-09-30","2019-12-31","2020-03-31","2020-06-30","2020-09-30","2020-12-31","2021-03-31","2021-06-30","2021-09-30","2021-12-31","2022-03-31","2022-06-30","2022-09-30","2022-11-30"],"y":[0,0,0,8.45449950144139e-18,1.36421916821599e-16,1.45758688682238e-17,-4.32983722988745e-17,-4.49275826133609e-17,5.20136752306469e-17,2.0014182589953e-17,-2.5345947961434e-17,-3.11505247003245e-17,-1.43620754142589e-17,1.00646338815791e-17,3.38475585197929e-17,-8.10466291550049e-17,1.0808556675081e-17,-4.31210859166872e-17,3.1140337373688e-17,-5.70347221823569e-17,1.81507129767245e-18,6.2931800233799e-17,7.47284289455631e-17,-4.02656509856801e-17,6.71357986574647e-17,-2.04650486520123e-19,3.70274370650044e-18,8.1079661296164e-19,-2.62917673467206e-18,6.74778008373494e-18,1.2079044536526e-17,-1.18941000054793e-17,5.45726833091956e-17],"type":"bar","name":"GDAXI","marker":{"color":"rgba(231,138,195,1)","line":{"color":"rgba(231,138,195,1)"}},"textfont":{"color":"rgba(231,138,195,1)"},"error_y":{"color":"rgba(231,138,195,1)"},"error_x":{"color":"rgba(231,138,195,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2014-12-31","2015-03-31","2015-06-30","2015-09-30","2015-12-31","2016-03-31","2016-06-30","2016-09-30","2016-12-30","2017-03-31","2017-06-30","2017-09-29","2017-12-29","2018-03-30","2018-06-29","2018-09-28","2018-12-28","2019-03-29","2019-06-28","2019-09-30","2019-12-31","2020-03-31","2020-06-30","2020-09-30","2020-12-31","2021-03-31","2021-06-30","2021-09-30","2021-12-31","2022-03-31","2022-06-30","2022-09-30","2022-11-30"],"y":[2.94233324263919e-17,-1.07319055576662e-17,2.27150763385929e-17,-6.6338305187042e-17,-1.25117061034524e-16,3.31930376069111e-17,8.5756788004626e-18,-3.61092471984046e-17,-1.54209722023754e-19,1.95140782253674e-17,-2.66193064385051e-18,8.1053667223666e-19,6.84203323272364e-18,1.19301094297273e-17,3.12394634050502e-17,-1.13199896061046e-17,-2.92673718441193e-17,-9.13139123088832e-18,1.07722677451722e-17,6.79813867469521e-18,1.12507270101923e-17,-2.87996887766142e-17,0,7.13963023053805e-19,0.00891906861044613,-1.43054311140833e-20,0,1.73562108154961e-18,0,-2.55978850146522e-18,0,1.23693241846858e-17,-7.40993771960331e-18],"type":"bar","name":"HSI","marker":{"color":"rgba(166,216,84,1)","line":{"color":"rgba(166,216,84,1)"}},"textfont":{"color":"rgba(166,216,84,1)"},"error_y":{"color":"rgba(166,216,84,1)"},"error_x":{"color":"rgba(166,216,84,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2014-12-31","2015-03-31","2015-06-30","2015-09-30","2015-12-31","2016-03-31","2016-06-30","2016-09-30","2016-12-30","2017-03-31","2017-06-30","2017-09-29","2017-12-29","2018-03-30","2018-06-29","2018-09-28","2018-12-28","2019-03-29","2019-06-28","2019-09-30","2019-12-31","2020-03-31","2020-06-30","2020-09-30","2020-12-31","2021-03-31","2021-06-30","2021-09-30","2021-12-31","2022-03-31","2022-06-30","2022-09-30","2022-11-30"],"y":[0.0904945159430238,0.0805706383103302,0.129686097110507,0.0825068146995806,0.0170330142098472,0,0.0155770852238952,0.0218708859231662,0,3.46944695195361e-18,0.0151950076090327,0.0291666181510809,0.0117277027434532,0.0355977698084964,0.0277057922381896,0,1.92269211763165e-17,0,0,0,0,0,0.0223581479746837,0.00452093082078453,0,0.0195559956407882,0.0339678308720395,0,0.00452649845526073,0,1.35765108014634e-18,0,0.0267772281353278],"type":"bar","name":"N225","marker":{"color":"rgba(255,217,47,1)","line":{"color":"rgba(255,217,47,1)"}},"textfont":{"color":"rgba(255,217,47,1)"},"error_y":{"color":"rgba(255,217,47,1)"},"error_x":{"color":"rgba(255,217,47,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2014-12-31","2015-03-31","2015-06-30","2015-09-30","2015-12-31","2016-03-31","2016-06-30","2016-09-30","2016-12-30","2017-03-31","2017-06-30","2017-09-29","2017-12-29","2018-03-30","2018-06-29","2018-09-28","2018-12-28","2019-03-29","2019-06-28","2019-09-30","2019-12-31","2020-03-31","2020-06-30","2020-09-30","2020-12-31","2021-03-31","2021-06-30","2021-09-30","2021-12-31","2022-03-31","2022-06-30","2022-09-30","2022-11-30"],"y":[0.191290590006522,0.200546082356841,0.193795029871175,0.126822861177792,0.185155031043614,0.154449674664162,0.14688636185561,0.166760035241437,0.131446887227524,0.168497636466209,0.147821410470036,0.150543230957148,0.156115386330948,0.111362215761458,0.0882108632526152,0.0383275707207607,0.155102779538438,0.175515844421266,0.246411296658546,0.256419300527339,0.262057334529144,0.140395963034141,0.080714830482732,0.0548783208693744,0.0152630568044158,-4.33680868994202e-19,0.0243135149577849,0.0232612859993022,0.0251847856216856,0.0350371372290417,0.0293627771146664,0.0416957008594504,0.0779484544926343],"type":"bar","name":"SENSEX","marker":{"color":"rgba(229,196,148,1)","line":{"color":"rgba(229,196,148,1)"}},"textfont":{"color":"rgba(229,196,148,1)"},"error_y":{"color":"rgba(229,196,148,1)"},"error_x":{"color":"rgba(229,196,148,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2014-12-31","2015-03-31","2015-06-30","2015-09-30","2015-12-31","2016-03-31","2016-06-30","2016-09-30","2016-12-30","2017-03-31","2017-06-30","2017-09-29","2017-12-29","2018-03-30","2018-06-29","2018-09-28","2018-12-28","2019-03-29","2019-06-28","2019-09-30","2019-12-31","2020-03-31","2020-06-30","2020-09-30","2020-12-31","2021-03-31","2021-06-30","2021-09-30","2021-12-31","2022-03-31","2022-06-30","2022-09-30","2022-11-30"],"y":[0.134663666680153,0.151653851615316,0.231537303859927,0.359527085413288,0.3535985945238,0.212543248275442,0.245575725783189,0.217410895383203,0.418845691364275,0.39912363011048,0.431394923817774,0.413429420230165,0.474852036129808,0.412777842601242,0.491356422614669,0.506291099076237,0.301351576795811,0.266217015211295,0.175058099563114,0.20395642131461,0.193156861265843,0.19873972761579,0.0583159388966208,0,0.00497347076216611,-1.04645358152098e-18,4.31559212531677e-18,-8.06911009006739e-18,-5.33074723312883e-18,8.20641960692658e-19,-4.27985847117026e-18,-6.94024312724921e-20,0],"type":"bar","name":"SPX","marker":{"color":"rgba(179,179,179,1)","line":{"color":"rgba(179,179,179,1)"}},"textfont":{"color":"rgba(179,179,179,1)"},"error_y":{"color":"rgba(179,179,179,1)"},"error_x":{"color":"rgba(179,179,179,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
]

---
layout: true

### &gt;&gt; 3.5 投资组合优化（改进版）

---
  
.code90[

```r
# Update the constraint
box_ps &lt;- base_ps %&gt;% 
* add.constraint(type = "box", min = 0.05, max = 0.4, indexnum = 2)
# Q：如何给单个资产设置权重上下限？
```


```r
# Backtest
opt_box &lt;- optimize.portfolio.rebalancing(
  R = returns,
  portfolio = box_ps,
  optimize_method = "ROI",
  rebalance_on = "quarters",
  training_period = 60, 
  rolling_window = 60
)

# Calculate portfolio returns
box_rets &lt;- Return.portfolio(returns, extractWeights(opt_box))
colnames(box_rets) &lt;- "box"
```
]

---
  
.code90[

```r
# Compare annualized performance
cbind(bnchmk_rets, base_rets, box_rets) %&gt;% na.omit() %&gt;% 
  table.AnnualizedReturns()
```

```
#&gt;                           benchmark   base    box
#&gt; Annualized Return            0.0512 0.0331 0.0368
#&gt; Annualized Std Dev           0.1377 0.1263 0.1294
#&gt; Annualized Sharpe (Rf=0%)    0.3716 0.2619 0.2848
```
]

--
  
<div id="htmlwidget-3e6af013fdc19ff3313a" style="width:80%;height:320px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-3e6af013fdc19ff3313a">{"x":{"visdat":{"312073d66c0c":["function () ","plotlyVisDat"]},"cur_data":"312073d66c0c","attrs":{"312073d66c0c":{"x":{},"y":{},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"layout":{"height":320,"margin":{"b":40,"l":60,"t":25,"r":10},"barmode":"stack","xaxis":{"domain":[0,1],"automargin":true,"title":""},"yaxis":{"domain":[0,1],"automargin":true,"title":"Weights(%)","tickformat":".0%"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["2014-12-31","2015-03-31","2015-06-30","2015-09-30","2015-12-31","2016-03-31","2016-06-30","2016-09-30","2016-12-30","2017-03-31","2017-06-30","2017-09-29","2017-12-29","2018-03-30","2018-06-29","2018-09-28","2018-12-28","2019-03-29","2019-06-28","2019-09-30","2019-12-31","2020-03-31","2020-06-30","2020-09-30","2020-12-31","2021-03-31","2021-06-30","2021-09-30","2021-12-31","2022-03-31","2022-06-30","2022-09-30","2022-11-30"],"y":[0.0667792019912331,0.0865177100881295,0.0745640914356621,0.0683855219780565,0.0683121369890296,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.0660060564353966,0.108990806187082,0.160734262959733,0.225710525996913,0.3,0.313128179783279,0.3,0.306992735165022,0.3,0.3,0.3,0.281107044243311],"type":"bar","name":"000300","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2014-12-31","2015-03-31","2015-06-30","2015-09-30","2015-12-31","2016-03-31","2016-06-30","2016-09-30","2016-12-30","2017-03-31","2017-06-30","2017-09-29","2017-12-29","2018-03-30","2018-06-29","2018-09-28","2018-12-28","2019-03-29","2019-06-28","2019-09-30","2019-12-31","2020-03-31","2020-06-30","2020-09-30","2020-12-31","2021-03-31","2021-06-30","2021-09-30","2021-12-31","2022-03-31","2022-06-30","2022-09-30","2022-11-30"],"y":[0.05,0.0499999999999999,0.0500000000000001,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.0500000000000001,0.05,0.0500000000000001,0.05,0.05,0.05,0.0560934321579595,0.05,0.05,0.0499999999999999,0.0499999999999999,0.05,0.05,0.05,0.0499999999999999,0.05],"type":"bar","name":"FCHI","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2014-12-31","2015-03-31","2015-06-30","2015-09-30","2015-12-31","2016-03-31","2016-06-30","2016-09-30","2016-12-30","2017-03-31","2017-06-30","2017-09-29","2017-12-29","2018-03-30","2018-06-29","2018-09-28","2018-12-28","2019-03-29","2019-06-28","2019-09-30","2019-12-31","2020-03-31","2020-06-30","2020-09-30","2020-12-31","2021-03-31","2021-06-30","2021-09-30","2021-12-31","2022-03-31","2022-06-30","2022-09-30","2022-11-30"],"y":[0.4,0.38699843909801,0.277620355851669,0.263911631261257,0.275774934906191,0.4,0.4,0.4,0.343734405753883,0.313412561529893,0.307244352948621,0.321703405177165,0.282567793330796,0.369553789181739,0.327184659976765,0.373334236511577,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.386871820216721,0.4,0.393007264834978,0.4,0.4,0.4,0.4],"type":"bar","name":"FTSE","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2014-12-31","2015-03-31","2015-06-30","2015-09-30","2015-12-31","2016-03-31","2016-06-30","2016-09-30","2016-12-30","2017-03-31","2017-06-30","2017-09-29","2017-12-29","2018-03-30","2018-06-29","2018-09-28","2018-12-28","2019-03-29","2019-06-28","2019-09-30","2019-12-31","2020-03-31","2020-06-30","2020-09-30","2020-12-31","2021-03-31","2021-06-30","2021-09-30","2021-12-31","2022-03-31","2022-06-30","2022-09-30","2022-11-30"],"y":[0.05,0.05,0.05,0.05,0.0500000000000002,0.0499999999999999,0.0499999999999999,0.0499999999999999,0.05,0.0500000000000001,0.05,0.0499999999999999,0.0499999999999999,0.05,0.05,0.0499999999999998,0.05,0.0499999999999999,0.0499999999999999,0.0499999999999999,0.05,0.05,0.0500000000000002,0.0499999999999999,0.05,0.05,0.05,0.05,0.0499999999999999,0.05,0.05,0.05,0.05],"type":"bar","name":"GDAXI","marker":{"color":"rgba(231,138,195,1)","line":{"color":"rgba(231,138,195,1)"}},"textfont":{"color":"rgba(231,138,195,1)"},"error_y":{"color":"rgba(231,138,195,1)"},"error_x":{"color":"rgba(231,138,195,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2014-12-31","2015-03-31","2015-06-30","2015-09-30","2015-12-31","2016-03-31","2016-06-30","2016-09-30","2016-12-30","2017-03-31","2017-06-30","2017-09-29","2017-12-29","2018-03-30","2018-06-29","2018-09-28","2018-12-28","2019-03-29","2019-06-28","2019-09-30","2019-12-31","2020-03-31","2020-06-30","2020-09-30","2020-12-31","2021-03-31","2021-06-30","2021-09-30","2021-12-31","2022-03-31","2022-06-30","2022-09-30","2022-11-30"],"y":[0.0500000000000001,0.05,0.0500000000000001,0.0499999999999999,0.0499999999999998,0.05,0.05,0.05,0.05,0.0500000000000001,0.05,0.05,0.05,0.05,0.05,0.0499999999999999,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.053959015873062,0.0743640887717865,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05],"type":"bar","name":"HSI","marker":{"color":"rgba(166,216,84,1)","line":{"color":"rgba(166,216,84,1)"}},"textfont":{"color":"rgba(166,216,84,1)"},"error_y":{"color":"rgba(166,216,84,1)"},"error_x":{"color":"rgba(166,216,84,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2014-12-31","2015-03-31","2015-06-30","2015-09-30","2015-12-31","2016-03-31","2016-06-30","2016-09-30","2016-12-30","2017-03-31","2017-06-30","2017-09-29","2017-12-29","2018-03-30","2018-06-29","2018-09-28","2018-12-28","2019-03-29","2019-06-28","2019-09-30","2019-12-31","2020-03-31","2020-06-30","2020-09-30","2020-12-31","2021-03-31","2021-06-30","2021-09-30","2021-12-31","2022-03-31","2022-06-30","2022-09-30","2022-11-30"],"y":[0.0758128741402245,0.0633877328583881,0.113490749342645,0.0668784861511397,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.0527186303861158,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05],"type":"bar","name":"N225","marker":{"color":"rgba(255,217,47,1)","line":{"color":"rgba(255,217,47,1)"}},"textfont":{"color":"rgba(255,217,47,1)"},"error_y":{"color":"rgba(255,217,47,1)"},"error_x":{"color":"rgba(255,217,47,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2014-12-31","2015-03-31","2015-06-30","2015-09-30","2015-12-31","2016-03-31","2016-06-30","2016-09-30","2016-12-30","2017-03-31","2017-06-30","2017-09-29","2017-12-29","2018-03-30","2018-06-29","2018-09-28","2018-12-28","2019-03-29","2019-06-28","2019-09-30","2019-12-31","2020-03-31","2020-06-30","2020-09-30","2020-12-31","2021-03-31","2021-06-30","2021-09-30","2021-12-31","2022-03-31","2022-06-30","2022-09-30","2022-11-30"],"y":[0.172402294450275,0.178072103254266,0.172817092502801,0.112036580623965,0.169490398482542,0.131344726607587,0.118898978626813,0.141597178371685,0.100691116488492,0.14187624488647,0.127815579054915,0.135933871621351,0.139070186884321,0.100045525791297,0.0796033695039117,0.05,0.15363475365028,0.18971066438304,0.272978101021277,0.268006303920787,0.27292722012401,0.162333036087628,0.130283800817616,0.128158921657013,0.0571694180411634,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.0688929557566891],"type":"bar","name":"SENSEX","marker":{"color":"rgba(229,196,148,1)","line":{"color":"rgba(229,196,148,1)"}},"textfont":{"color":"rgba(229,196,148,1)"},"error_y":{"color":"rgba(229,196,148,1)"},"error_x":{"color":"rgba(229,196,148,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2014-12-31","2015-03-31","2015-06-30","2015-09-30","2015-12-31","2016-03-31","2016-06-30","2016-09-30","2016-12-30","2017-03-31","2017-06-30","2017-09-29","2017-12-29","2018-03-30","2018-06-29","2018-09-28","2018-12-28","2019-03-29","2019-06-28","2019-09-30","2019-12-31","2020-03-31","2020-06-30","2020-09-30","2020-12-31","2021-03-31","2021-06-30","2021-09-30","2021-12-31","2022-03-31","2022-06-30","2022-09-30","2022-11-30"],"y":[0.135005629418267,0.135024014701206,0.211507710867223,0.338787779985583,0.286422529622237,0.218655273392413,0.231101021373186,0.208402821628315,0.305574477757625,0.294711193583637,0.314940067996465,0.292362723201484,0.328362019784884,0.280400685026964,0.343211970519324,0.326665763488423,0.19636524634972,0.16028933561696,0.0770218989787233,0.0819936960792135,0.0770727798759903,0.171660907476976,0.160725392995301,0.0983357369661164,0.0927559671901375,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05],"type":"bar","name":"SPX","marker":{"color":"rgba(179,179,179,1)","line":{"color":"rgba(179,179,179,1)"}},"textfont":{"color":"rgba(179,179,179,1)"},"error_y":{"color":"rgba(179,179,179,1)"},"error_x":{"color":"rgba(179,179,179,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

---
layout: false
class: inverse, center, middle

# 课后作业

---

### &gt;&gt; 课后作业

.font140.bold[

1. 理解投资组合优化的原理以及 `PortfolioAnalytics` 包的实现
&gt; .code70[
```
vignette("portfolio_vignette", package = "PortfolioAnalytics")
# 31 demos in total
demo(package = "PortfolioAnalytics")
```
]

2. 个人编程作业：复现 / 改进本讲“3. 案例”的代码
]

.font120[
    
- 综合利用本课程所讲 / 所学知识完成数据导入、清洁 -&gt; 探索性分析 -&gt; 构建投资组合 -&gt; 分析投资组合绩效；

- 使用 📑 _Rmd_ 或 _qmd_ 文档记录你的研究过程（含R代码），并对结果进行简要分析；

- 将数据、Rmd文档/qmd文档、`knitr`后生成的html文档等打包为“L12\_投资组合\_[学号].zip”，于.red.bold[12月25日24:00前]提交至.bold[[{{坚果云收件箱 📬}}](https://send2me.cn/t6dwGFZ-/Tqi83uQyAxrY4g==)]。
   
]

---
class: center middle
background-image: url(imgs/xaringan.png)
background-size: 12%
background-position: 50% 40%


&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
&lt;hr color='#f00' size='2px' width='80%'&gt;
&lt;br&gt;
.Large.red[_**本网页版讲义的制作由 R 包 [{{`xaringan`}}](https://github.com/yihui/xaringan) 赋能！**_]

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="../libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
