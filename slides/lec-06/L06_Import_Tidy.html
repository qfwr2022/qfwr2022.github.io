<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>ç¬¬6è®² æ•°æ®å¯¼å…¥ä¸é½æ•´</title>
    <meta charset="utf-8" />
    <meta name="author" content=" æ›¾æ°¸è‰º" />
    <meta name="date" content="2022-11-11" />
    <script src="../libs/header-attrs/header-attrs.js"></script>
    <link href="../libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="../libs/tile-view/tile-view.js"></script>
    <link href="../libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <link href="../libs/panelset/panelset.css" rel="stylesheet" />
    <script src="../libs/panelset/panelset.js"></script>
    <script src="../libs/freezeframe/freezeframe.min.js"></script>
    <script src="../libs/xaringanExtra-freezeframe/freezeframe-init.js"></script>
    <script id="xaringanExtra-freezeframe-options" type="application/json">{"selector":"img[src$=\"gif\"]","trigger":"click","overlay":false,"responsive":false,"warnings":true}</script>
    <script type="application/json" id="xaringanExtra-editable-docid">{"id":"xeda7b107bc441d598bda5269a926a9c","expires":7}</script>
    <script src="../libs/himalaya/himalaya.js"></script>
    <script src="../libs/js-cookie/js.cookie.js"></script>
    <link href="../libs/editable/editable.css" rel="stylesheet" />
    <script src="../libs/editable/editable.js"></script>
    <link href="../libs/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <link href="../libs/animate.css/animate.xaringan.css" rel="stylesheet" />
    <script src="../libs/clipboard/clipboard.min.js"></script>
    <link href="../libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="../libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-copy\"><\/i>","success":"<i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"<i class=\"fa fa-times-circle\" style=\"color: #F94144\"><\/i>"})</script>
    <link href="../libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="../libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <link href="../libs/countdown/countdown.css" rel="stylesheet" />
    <script src="../libs/countdown/countdown.js"></script>
    <link rel="stylesheet" href="../libs/zen-styles-v2.3.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# é‡åŒ–é‡‘èä¸é‡‘èç¼–ç¨‹
]
.subtitle[
## L06 æ•°æ®å¯¼å…¥ä¸é½æ•´
]
.author[
### <br>æ›¾æ°¸è‰º
]
.institute[
### å¦é—¨å¤§å­¦ç®¡ç†å­¦é™¢
]
.date[
### <br>2022-11-11
]

---

class: middle
background-image: url(imgs/readr-tidyr.png)
background-size: 18%
background-position: 85% 50%



<div>
<style type="text/css">.xaringan-extra-logo {
width: 50px;
height: 50px;
z-index: 0;
background-image: url(imgs/logo-sm.png);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
top:0.5em;right:0.5em;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide):not(.inverse):not(.hide_logo)')
        .forEach(function (slide) {
          const logo = document.createElement('div')
          logo.classList = 'xaringan-extra-logo'
          logo.href = null
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div>

&gt; é—®æ¸ é‚£å¾—æ¸…å¦‚è®¸ï¼Ÿä¸ºæœ‰æºå¤´æ´»æ°´æ¥ã€‚â€”â€”[å®‹]æœ±ç†¹

--

&gt; Like families, tidy datasets are all alike but every messy &lt;br&gt;
&gt; dataset is messy in its own way. â€”â€”Hadley Wickham

&lt;br&gt;
--

.bold.font150[1\. æ•°æ®å¯¼å…¥]
  * .font120[è¯»å…¥çŸ©å½¢æ–‡æœ¬æ•°æ®ï¼š`readr` åŒ… &lt;sup&gt;.font80[2.1.3]&lt;/sup&gt;]
  * .font120[è¯»å…¥å…¶å®ƒç±»å‹çš„æ•°æ®]

--

.bold.font150[2\. æ•°æ®é½æ•´]
  * .font120[é½æ•´æ•°æ®]
  * .font120[`tidyr` åŒ… &lt;sup&gt;.font80[1.2.1]&lt;/sup&gt;]
  * .font120[`pivot_longer()` å’Œ `pivot_wider()`]
  * .font120[`separate()` å’Œ `unite()`]
  * .font120[å¤æ‚æ¡ˆä¾‹]
  * .font120[`unnest_*()` å’Œ `hoist()`]

---
class: inverse, center, middle

# 1. æ•°æ®å¯¼å…¥

.font150[(Data Import)]

---
layout: true

### &gt;&gt; è¯»å…¥æ–‡æœ¬æ–‡æ¡£ï¼š`readr` åŒ…

---

.full-width[.content-box-blue.bold.font120[â˜‘ ä¸€è‡´çš„å‡½æ•°å‘½åæ–¹å¼]]


```r
read_csv()   | read_csv2()      | read_tsv()   | read_delim()    |
read_table() | read_fwf()       |

read_lines() | read_lines_raw() | read_file()  | read_file_raw() | read_log()  | 
```

--

.full-width[.content-box-blue.bold.font120[â˜‘ åŸºæœ¬ä¸€è‡´çš„å‚æ•°è®¾ç½®]]

```r
read_*(file,  # delim = NULL, escape_backslash = FALSE, escape_double = TRUE,
       col_names = TRUE, col_types = NULL, col_select = NULL, 
       id = NULL, locale = default_locale(), 
       na = c("", "NA"), quoted_na = TRUE, quote = "\"", comment = "", trim_ws = TRUE, 
       skip = 0, n_max = Inf, guess_max = min(1000, n_max), 
       name_repair = "unique", num_threads = readr_threads(), 
       progress = show_progress(), show_col_types = should_show_types(), 
       skip_empty_rows = TRUE, lazy = should_read_lazy())
# file: Either a path to a file, a connection, or literal data. 
#       Files ending in .gz, .bz2, .xz, or .zip will be automatically uncompressed.
#       Files starting with http://, https://, ftp://, or ftps:// will be downloaded.
#       Using a value of clipboard() will read from the system clipboard.
```

---

.full-width[.content-box-blue.bold.font120[â˜‘ å’Œå†…ç½® `utils` åŒ…ä¸­ `read.*()` æ¯”è¾ƒ]]

--
.font110[
* ç”Ÿæˆ `tibble`.red[&lt;sup&gt;*&lt;/sup&gt;]ï¼ˆæ›´ç¡®åˆ‡åœ°è¯´åº”è¯¥æ˜¯ `spec_tbl_df`ï¼‰

* é»˜è®¤æƒ…å†µä¸‹åšå¾—æ›´å°‘ï¼Œå¦‚ä¸ä¼šè‡ªåŠ¨å°†å­—ç¬¦å‹å˜é‡è½¬æ¢ä¸ºå› å­å‹å˜é‡ï¼ˆ`read.*()`æœ‰ä¸ª`stringsAsFactors`å‚æ•°ï¼‰ã€ä¸ä¼šè‡ªåŠ¨æ›´æ”¹åˆ—åã€ä¸ä¼šå°†ä¸€åˆ—æ•°æ®è½¬åŒ–ä¸ºè¡Œåç­‰

* è¾ƒå°‘ä¾èµ–ç³»ç»Ÿå’Œç¯å¢ƒå˜é‡ï¼Œç»“æœæ›´å…·å¯é‡ç°æ€§ï¼ˆ_reproducible_ï¼‰

* è¯»å…¥é€Ÿåº¦é€šå¸¸æ›´å¿«ï¼ˆ~50xï¼‰ï¼Œä¸”è¯»å…¥å¤§æ–‡ä»¶æ—¶æœ‰è¿›åº¦æ¡æç¤º

]

--

```
?`tbl_df-class`
tibble: a subclass of data.frame and the central data structure for the tidyverse
lazy and surly - do less and complain more than base data.frames.
======================================================================================

1. åˆ—æ•°æ®ä¸è¿›è¡Œè‡ªåŠ¨ç±»å‹è½¬æ¢ï¼ˆå¦‚å­—ç¬¦-&gt;å› å­ï¼‰ï¼Œä¸”åŸç”Ÿç›´æ¥æ”¯æŒåˆ—è¡¨åˆ—
2. åªå¯¹é•¿åº¦ä¸º1çš„â€œæ ‡é‡â€å‘é‡è¿›è¡Œå¾ªç¯æ“ä½œ
3. tibbleæ”¯æŒä¸åˆæ³•çš„æ•°æ®å˜é‡åï¼Œå¦‚ tibble(`:)` = "smile")
4. ä¸å¢åŠ è¡Œåï¼Œä¹Ÿä¸é¼“åŠ±ä½¿ç”¨è¡Œåæ¥å­˜å‚¨æ•°æ®ä¿¡æ¯
5. ç”¨ [ å¯¹tibbleå–å­é›†æ“ä½œæ€»æ˜¯è¿”å›æ–°çš„tibbleï¼Œ[[ å’Œ $ æ€»æ˜¯è¿”å›å‘é‡ï¼Œä¸” $ ä¸æ”¯æŒå˜é‡åéƒ¨åˆ†åŒ¹é…
6. tibbleåœ¨å±å¹•ä¸Šæ‰“å°è¾“å‡ºæ—¶ä¼šé€‚åº”å±å¹•å¤§å°ï¼Œå¹¶æä¾›æ›´å¤šæœ‰ç”¨ä¿¡æ¯ï¼ˆç±»ä¼¼str()ï¼‰
```

---

.full-width[.content-box-blue.bold.font120[å¸¸ç”¨å‚æ•°ç¤ºä¾‹ï¼š`read_csv()`]]
--



.pull-left.code80[

```r
library(tidyverse)
read_csv("The 1st line of metadata
         The 2nd line of metadata
         # A comment to skip
         x,y,z
         1,2,3", 
         skip = 2,
         comment = "#")
```

```
#&gt; Rows: 1 Columns: 3
#&gt; â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#&gt; Delimiter: ","
#&gt; dbl (3): x, y, z
#&gt; 
#&gt; â„¹ Use `spec()` to retrieve the full column specification for this data.
#&gt; â„¹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
```

```
#&gt; # A tibble: 1 Ã— 3
#&gt;       x     y     z
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     1     2     3
```
]
--

.pull-right.code80[

```r
read_csv("1,2,3\n4,5,6")
```

```
#&gt; # A tibble: 1 Ã— 3
#&gt;     `1`   `2`   `3`
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     4     5     6
```


```r
read_csv("1,2,3\n4,5,6", 
         col_names = FALSE)
```

```
#&gt; # A tibble: 2 Ã— 3
#&gt;      X1    X2    X3
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     1     2     3
#&gt; 2     4     5     6
```


```r
read_csv("1,2,3\n4,5,6", 
         col_names = c("x", "y", "z"))
```

```
#&gt; # A tibble: 2 Ã— 3
#&gt;       x     y     z
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     1     2     3
#&gt; 2     4     5     6
```

]

---

.full-width[.content-box-blue.bold.font120[`readr` åŒ…é‡‡ç”¨å¯å‘å¼ç­–ç•¥æ¥è§£ææ–‡æœ¬æ–‡æ¡£ä¸­æ•°æ®]]


```r
#  ç”Ÿæˆç¤ºä¾‹æ•°æ®æ–‡æ¡£
set.seed(123456)   # è®¾å®šéšæœºæ•°ç§å­
nycflights13::flights %&gt;% 
  mutate(dep_delay = if_else(dep_delay &lt;= 0, FALSE, TRUE)) %&gt;% 
  select(month:dep_time, dep_delay, tailnum, time_hour) %&gt;% 
  slice_sample(n = 20) %&gt;%  
  mutate(across(everything(), ~ifelse(runif(20) &lt;= 0.1, NA, .))) %&gt;% 
  mutate(time_hour = lubridate::as_datetime(time_hour)) %&gt;% 
* print(n = 5) %&gt;%
  write_csv(file = "data/ex_flights.csv", na = "--")  # é»˜è®¤na = "NA"
```

```
#&gt; # A tibble: 20 Ã— 6
#&gt;   month   day dep_time dep_delay tailnum time_hour          
#&gt;   &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;lgl&gt;     &lt;chr&gt;   &lt;dttm&gt;             
#&gt; 1     6    26      932 TRUE      &lt;NA&gt;    2013-06-26 12:00:00
#&gt; 2    NA     5       NA NA        &lt;NA&gt;    2013-12-05 17:00:00
#&gt; 3     7    20      656 FALSE     N17245  2013-07-20 10:00:00
#&gt; 4     5    16       NA FALSE     N27152  2013-05-16 12:00:00
#&gt; 5    12    23       NA NA        &lt;NA&gt;    2013-12-23 23:00:00
#&gt; # â€¦ with 15 more rows
```

---
.full-width[.content-box-blue.bold.font120[`readr` åŒ…é‡‡ç”¨å¯å‘å¼ç­–ç•¥æ¥è§£ææ–‡æœ¬æ–‡æ¡£ä¸­æ•°æ®]]


```r
(ex_flights &lt;- read_csv("data/ex_flights.csv"))  # é»˜è®¤na = c("", "NA")
```

```
#&gt; Rows: 20 Columns: 6
#&gt; â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#&gt; Delimiter: ","
#&gt; chr (6): month, day, dep_time, dep_delay, tailnum, time_hour
#&gt; 
#&gt; â„¹ Use `spec()` to retrieve the full column specification for this data.
#&gt; â„¹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
```

```
#&gt; # A tibble: 20 Ã— 6
#&gt;   month day   dep_time dep_delay tailnum time_hour           
#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;               
#&gt; 1 6     26    932      TRUE      --      2013-06-26T12:00:00Z
#&gt; 2 --    5     --       --        --      2013-12-05T17:00:00Z
#&gt; 3 7     20    656      FALSE     N17245  2013-07-20T10:00:00Z
#&gt; 4 5     16    --       FALSE     N27152  2013-05-16T12:00:00Z
#&gt; 5 12    23    --       --        --      2013-12-23T23:00:00Z
#&gt; # â€¦ with 15 more rows
```

---

.full-width[.content-box-blue.bold.font120[`readr` åŒ…é‡‡ç”¨å¯å‘å¼ç­–ç•¥æ¥è§£ææ–‡æœ¬æ–‡æ¡£ä¸­æ•°æ®]]

&gt; .font120[1\. æ ¹æ®ç»™å®šæˆ–çŒœæµ‹çš„åˆ†éš”ç¬¦å°†æ–‡æœ¬æ–‡æ¡£åˆ†å‰²ä¸ºå­—ç¬¦ä¸²çŸ©é˜µ]  
&gt; .font120[2\. ç¡®å®šæ¯åˆ—å­—ç¬¦ä¸²å‘é‡çš„ç±»å‹]  
&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;2\.1 ç”± `col_types` å‚æ•°ç›´æ¥ç»™å®š  
&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;2\.2 çŒœæµ‹ï¼šè¯»å…¥æ–‡æ¡£ `guess_max` è¡Œï¼ˆv2 vs. v1ï¼‰ï¼Œå¹¶æŒ‰å¦‚ä¸‹é¡ºåºçŒœæµ‹æ¯åˆ—å˜é‡çš„ç±»å‹ï¼š*logical -&gt; ~~integer -&gt;~~ double -&gt; ~~number -&gt;~~ time -&gt; date -&gt; date-time -&gt; character *  
&gt; .font120[3\. å°†æ¯åˆ—å­—ç¬¦ä¸²è§£æä¸ºç›¸åº”ç±»å‹çš„å‘é‡]

--

.full-width[.content-box-blue.bold.font120[å½“å‘ç° `readr` è‡ªåŠ¨è§£æç¢°åˆ°é—®é¢˜æ—¶]]
 
 * å¯ç”¨ `problems()` æŸ¥çœ‹è¯»å…¥æ—¶é‡åˆ°çš„é—®é¢˜
 
 * æ ¹æ®éœ€è¦è®¾å®š `read_*()` çš„ç›¸å…³å‚æ•°ï¼Œå¦‚ `na = "--"`
 
 * ç›´æ¥è®¾å®š `read_*()` çš„å‚æ•° `col_types = cols(...)`
 
 * å°†å…¨éƒ¨æ•°æ®è¯»å…¥ä¸ºå­—ç¬¦å‹å˜é‡ï¼Œç„¶åå†ç”¨ `type_convert()` è½¬æ¢å˜é‡ç±»å‹
 
 * åœ¨åç»­çš„æ•°æ®æ•´ç†æ­¥éª¤ä¸­è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼ˆå¦‚ `dplyr::muate() + parse_*()`ï¼‰

---

.pull-left.code75[

```r
# è®¾å®šç¼ºå¤±å€¼å‚æ•°
read_csv("data/ex_flights.csv", 
         na = "--") %&gt;% spec()
```

```
#&gt; cols(
#&gt;   month = col_double(),
#&gt;   day = col_double(),
#&gt;   dep_time = col_double(),
#&gt;   dep_delay = col_logical(),
#&gt;   tailnum = col_character(),
#&gt;   time_hour = col_datetime(format = "")
#&gt; )
```

```r
# ç›´æ¥è®¾å®šå‚æ•°col_typesï¼Œ?cols
ex_flights &lt;- read_csv(
  "data/ex_flights.csv", 
  col_types = cols(  # cols_only()
    dep_delay = col_logical(),    # "l"
    tailnum   = col_character(),  # "c"
    time_hour = col_datetime(),   # "T"
    .default  = col_integer()
  ) # col_types = "iiilcT"
)
```

```
#&gt; Warning: One or more parsing issues, call `problems()` on
#&gt; your data frame for details, e.g.:
#&gt;   dat &lt;- vroom(...)
#&gt;   problems(dat)
```
]

--

.pull-right.code80[

```r
problems(ex_flights)
```

```
#&gt; # A tibble: 17 Ã— 5
#&gt;     row   col expected           actual file                                              
#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;  &lt;chr&gt;                                             
#&gt; 1     3     1 an integer         --     C:/Users/admin/Desktop/QFwR_2022.09/slides/L06_Imâ€¦
#&gt; 2     3     3 an integer         --     C:/Users/admin/Desktop/QFwR_2022.09/slides/L06_Imâ€¦
#&gt; 3     3     4 1/0/T/F/TRUE/FALSE --     C:/Users/admin/Desktop/QFwR_2022.09/slides/L06_Imâ€¦
#&gt; # â€¦ with 14 more rows
```

```r
# å…¨éƒ¨è¯»å…¥ï¼Œå†è¡Œè½¬æ¢ç±»å‹
read_csv(
  "data/ex_flights.csv",
  col_types = cols(
*   .default = col_character()
  )
) %&gt;% 
* type_convert(col_types = "iiilcT")
```

```
#&gt; # A tibble: 20 Ã— 6
#&gt;   month   day dep_time dep_delay tailnum time_hour          
#&gt;   &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;lgl&gt;     &lt;chr&gt;   &lt;dttm&gt;             
#&gt; 1     6    26      932 TRUE      --      2013-06-26 12:00:00
#&gt; 2    NA     5       NA NA        --      2013-12-05 17:00:00
#&gt; 3     7    20      656 FALSE     N17245  2013-07-20 10:00:00
#&gt; # â€¦ with 17 more rows
```
]

---

.full-width[.content-box-blue.bold.font120[ä¸€æ¬¡æ€§è¯»å…¥å¤šä¸ªç›¸åŒæ€§è´¨çš„æ–‡æ¡£]]


```r
# ç”Ÿæˆç›¸åŒæ€§è´¨çš„ç¤ºä¾‹æ–‡æ¡£
nycflights13::flights %&gt;% split(.$carrier) %&gt;% 
  purrr::iwalk(~ write_tsv(.x, glue::glue("data/flights_{.y}.tsv")))
```

--


```r
# æ–‡ä»¶è·¯å¾„å‘é‡
(files &lt;- dir(path = "data/", pattern = "\\.tsv$", full.names = TRUE))
```

```
#&gt;  [1] "data/flights_9E.tsv" "data/flights_AA.tsv" "data/flights_AS.tsv"
#&gt;  [4] "data/flights_B6.tsv" "data/flights_DL.tsv" "data/flights_EV.tsv"
#&gt;  [7] "data/flights_F9.tsv" "data/flights_FL.tsv" "data/flights_HA.tsv"
#&gt; [10] "data/flights_MQ.tsv" "data/flights_OO.tsv" "data/flights_UA.tsv"
#&gt; [13] "data/flights_US.tsv" "data/flights_VX.tsv" "data/flights_WN.tsv"
#&gt; [16] "data/flights_YV.tsv"
```

```r
# ä¸€æ¬¡æ€§è¯»å…¥ï¼ˆå¹¶çºµå‘åˆå¹¶ä¸º tibbleï¼‰
read_tsv(files, id = "fpath")  # è¿™é‡Œé€šè¿‡è®¾ç½® id å‚æ•°å°†æ–‡ä»¶è·¯å¾„å­˜å…¥æŒ‡å®šå˜é‡fpathä¸­
```

```
#&gt; # A tibble: 336,776 Ã— 20
#&gt;   fpath    year month   day dep_tâ€¦Â¹ schedâ€¦Â² dep_dâ€¦Â³ arr_tâ€¦â´ schedâ€¦âµ arr_dâ€¦â¶ carrier flight
#&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
#&gt; 1 data/fâ€¦  2013     1     1     810     810       0    1048    1037      11 9E        3538
#&gt; 2 data/fâ€¦  2013     1     1    1451    1500      -9    1634    1636      -2 9E        4105
#&gt; 3 data/fâ€¦  2013     1     1    1452    1455      -3    1637    1639      -2 9E        3295
#&gt; # â€¦ with 336,773 more rows, 8 more variables: tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, and
#&gt; #   abbreviated variable names Â¹â€‹dep_time, Â²â€‹sched_dep_time, Â³â€‹dep_delay, â´â€‹arr_time,
#&gt; #   âµâ€‹sched_arr_time, â¶â€‹arr_delay
```

---

.full-width[.content-box-blue.bold.font120[`readr` çš„å›¾å½¢åŒ–ç”¨æˆ·ç•Œé¢ &lt;sup&gt;.font80.red[*]&lt;/sup&gt;]]

&lt;img src="imgs/readr_UI.png" width="88%" style="display: block; margin: auto;" /&gt;

.footnote.red.font80[\* `RStudio` å³ä¸Š `Environment` æ ‡ç­¾é¡µ &gt; `Import Dataset` &gt; `From Text (readr)` ...]

---
layout: true

### &gt;&gt; è¯»å…¥å…¶å®ƒç±»å‹çš„æ•°æ®

---

--
.font110[
* .bold[`readr::read_rds()`]: `R` data files (*.rds*)
]

--

.pull-left.font110[
* ![](imgs/logo-vroom.png) [~~.bold[{{`vroom`}}~~]](https://vroom.r-lib.org/): Read and Write Rectangular Text Data **Quickly**

* ![](imgs/logo-readxl.png) [.bold[{{`readxl`}}]](https://readxl.tidyverse.org/): excel files (_.xls_ and _.xlsx_) &lt;- take a ğŸ§ at it!

* ![](imgs/logo-haven.png) [.bold[{{`haven`}}]](https://haven.tidyverse.org/): SPSS, Stata, and SAS files

* ![](imgs/logo-arrow.png) [.bold[{{`arrow`}}]](https://arrow.apache.org/docs/r/): Apache Arrow
]

--

.pull-right.font110[

* [.bold[{{`DBI`}}]](https://dbi.r-dbi.org/) with specific interface packages: databases, such as SQLite, MySQL and PostgreSQL

* .bold[`jsonlite`]: JSON files

* [.bold[{{`xml2`}}]](https://xml2.r-lib.org/): XML and HTML files

* ![](imgs/logo-rvest.png) [.bold[{{`rvest`}}]](https://rvest.tidyverse.org): HTML (Web Scraping)

* [.bold[{{`httr2`}}]](https://httr2.r-lib.org/): Web APIs

]

--

&lt;br&gt;
.font110[
* .bold[[{{å…¶å®ƒ}}](https://cran.r-project.org/web/views/)]: textã€networkã€spatialã€genomeã€image ç­‰ç±»å‹çš„æ•°æ®
]

---
layout: false
class: inverse, center, middle

# 2. æ•°æ®é½æ•´

.font150[(Tidy Data)]

---
layout: true

### &gt;&gt; é½æ•´æ•°æ®

---

.full-width[.content-box-blue.bold.font120[é½æ•´æ•°æ®çš„ä¸‰ä¸ªæ¡ä»¶ ğŸ“]]

.font120[

* æ¯åˆ—éƒ½æ˜¯ä¸€ä¸ªå˜é‡ï¼ˆEvery column is a variable.ï¼‰

* æ¯è¡Œéƒ½æ˜¯ä¸€ä¸ªè§‚æµ‹ï¼ˆEvery row is an observation.ï¼‰

* æ¯æ ¼éƒ½æ˜¯ä¸€ä¸ªå–å€¼ï¼ˆEvery cell is a single value.ï¼‰
]

--
&lt;img src="imgs/tidy-1.png" width="85%" style="display: block; margin: auto;" /&gt;

---

.full-width[.content-box-blue.bold.font120[é½æ•´æ•°æ®çš„å¥½å¤„ ğŸ’ª]]

.font120[

â˜‘ é½æ•´æ•°æ®æŒ‰ç…§é€»è¾‘ä¸€è‡´çš„æ–¹å¼å­˜å‚¨æ•°æ®ï¼Œè¿™è®©ä½ æ›´å®¹æ˜“å­¦ä¹ å¹¶æŒæ¡ç›¸å…³å·¥å…·å¯¹æ•°æ®è¿›è¡Œå¤„ç†

â˜‘ â€œæ¯åˆ—éƒ½æ˜¯ä¸€ä¸ªå˜é‡â€åŠâ€œæ¯è¡Œéƒ½æ˜¯ä¸€ä¸ªè§‚æµ‹â€æœ‰åŠ©äºå‘æŒ¥ R è¯­è¨€å‘é‡åŒ–æ“ä½œçš„ä¼˜åŠ¿

]

&lt;img src="imgs/tidy-2.png" width="80%" style="display: block; margin: auto;" /&gt;

.font120[
â˜‘ `tidyverse` ä¸­çš„ R åŒ…ï¼ˆå¦‚ `dplyr` ç­‰ï¼‰åœ¨è®¾è®¡ä¸Šè¦æ±‚è¾“å…¥æ•°æ®ä¸ºé½æ•´æ•°æ®
]

---

.full-width[.content-box-blue.bold.font120[ä½†â€¦â€¦å¹¶éæ‰€æœ‰çš„æ•°æ®é›†éƒ½æ˜¯é½æ•´çš„ï¼ŒğŸ˜­]]

.pull-left.code80[

```r
table1
```

```
#&gt; # A tibble: 6 Ã— 4
#&gt;   country      year cases population
#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;int&gt;      &lt;int&gt;
#&gt; 1 Afghanistan  1999   745   19987071
#&gt; 2 Afghanistan  2000  2666   20595360
#&gt; 3 Brazil       1999 37737  172006362
#&gt; # â€¦ with 3 more rows
```

```r
table2
```

```
#&gt; # A tibble: 12 Ã— 4
#&gt;   country      year type          count
#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;         &lt;int&gt;
#&gt; 1 Afghanistan  1999 cases           745
#&gt; 2 Afghanistan  1999 population 19987071
#&gt; 3 Afghanistan  2000 cases          2666
#&gt; # â€¦ with 9 more rows
```
]

.pull-right.code70[

```r
table3
```

```
#&gt; # A tibble: 6 Ã— 3
#&gt;   country      year rate           
#&gt; * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;          
#&gt; 1 Afghanistan  1999 745/19987071   
#&gt; 2 Afghanistan  2000 2666/20595360  
#&gt; 3 Brazil       1999 37737/172006362
#&gt; # â€¦ with 3 more rows
```

```r
table4a   # cases
```

```
#&gt; # A tibble: 3 Ã— 3
#&gt;   country     `1999` `2000`
#&gt; * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
#&gt; 1 Afghanistan    745   2666
#&gt; 2 Brazil       37737  80488
#&gt; 3 China       212258 213766
```

```r
table4b   # population
```

```
#&gt; # A tibble: 3 Ã— 3
#&gt;   country         `1999`     `2000`
#&gt; * &lt;chr&gt;            &lt;int&gt;      &lt;int&gt;
#&gt; 1 Afghanistan   19987071   20595360
#&gt; 2 Brazil       172006362  174504898
#&gt; 3 China       1272915272 1280428583
```
]

---
layout: true

### &gt;&gt; è¯¥ `tidyr` åŒ…å‡ºåœºå•¦ ğŸ‰

---

.full-width[.content-box-blue.bold.font120[`tidyr`åŒ…ä¸­çš„å‡½æ•°å¤§è‡´å¯åˆ†ä¸º5å¤§ç±»ï¼š]]

.pull-left.font105[
1. æ•°æ®é•¿å‹-å®½å‹è½¬æ¢ï¼ˆ_pivoting_ï¼‰ï¼š`pivot_longer()` å’Œ `pivot_wider()`

2. åˆ†è§£æˆ–åˆå¹¶å­—ç¬¦å‹å˜é‡ï¼š`separate()`ã€`separate_rows()`ã€`extract()` å’Œ `unite()`

3. å°†æ·±åº¦åµŒå¥—çš„åˆ—è¡¨æ•°æ®è¡¨æ ¼åŒ–ï¼ˆ_rectangling_ï¼‰ï¼š`unnest_longer()`ã€`unnest_wider()`ã€`unnest_auto()` å’Œ `hoist()`

4. å°†åˆ†ç»„æ•°æ®æ¡†è½¬åŒ–æˆåµŒå¥—çš„æ•°æ®æ¡†ï¼ˆæ¯ç»„å ä¸€è¡Œï¼‰æˆ–åä¹‹ï¼š `nest()` å’Œ `unnest()`

5. **ç¼ºå¤±å€¼å¤„ç†ï¼š-&gt;**
]

--

.pull-right.font80[

- `complete(data, ..., fill = list())`: Complete a data frame with missing combinations of data

- `expand(data, ...)`, `crossing(...)`, `nesting(...)`: Expand data frame to include all combinations of values

- `expand_grid(...)`: Create a tibble from all combinations of the inputted name-value pairs

- `full_seq(x, period, tol = 1e-06)`: Create the full sequence of values in a vector

- `drop_na(data, ...)`: Drop rows containing missing values

- `fill(data, ..., .direction = c("down", "up", "downup", "updown"))`: Fill in missing values with previous or next value

- `replace_na(data, replace, ...)`: Replace missing values with specified values

]

---
layout: true

### &gt;&gt; **.red[`pivot_longer()`]** å’Œ `pivot_wider()`

---

&lt;img src="imgs/tidy-3.png" width="75%" style="display: block; margin: auto;" /&gt;

--

.pull-left.code80[

```r
pivot_longer(
* data, cols,
* names_to = "name",
  names_prefix = NULL,
  names_sep = NULL, 
  names_pattern = NULL, 
  names_ptypes = NULL, 
  names_transform = NULL, 
  names_repair = "check_unique", 
* values_to = "value",
  values_drop_na = FALSE, 
  values_ptypes = NULL,
  values_transform = NULL, ...
)
```
]

--

.pull-right.code80[

```r
table4a %&gt;% 
  pivot_longer(
    cols = c(`1999`, `2000`),
    names_to = "year", 
    values_to = "cases"
  )
# table4b %&gt;% ...
```

```
#&gt; # A tibble: 6 Ã— 3
#&gt;   country     year  cases
#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;int&gt;
#&gt; 1 Afghanistan 1999    745
#&gt; 2 Afghanistan 2000   2666
#&gt; 3 Brazil      1999  37737
#&gt; # â€¦ with 3 more rows
```
]

---
layout: true

### &gt;&gt; `pivot_longer()` å’Œ **.red[`pivot_wider()`]**

---

&lt;img src="imgs/tidy-4.png" width="75%" style="display: block; margin: auto;" /&gt;

--
.pull-left.code80[


```r
pivot_wider(
* data,
  id_cols = NULL, id_expand = FALSE,
* names_from = name,
  names_prefix = "", names_sep = "_", 
  names_glue = NULL, 
  names_sort = FALSE, 
  names_vary = "fastest",
  names_expand = FALSE, 
  names_repair = "check_unique",
* values_from = value,
  values_fill = NULL, values_fn = NULL, 
  unused_fn = NULL, ...
)
```
]

--

.pull-right.code80[

```r
table2 %&gt;% 
  pivot_wider(
    names_from = type, 
    values_from = count
  )
```

```
#&gt; # A tibble: 6 Ã— 4
#&gt;   country      year cases population
#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;int&gt;      &lt;int&gt;
#&gt; 1 Afghanistan  1999   745   19987071
#&gt; 2 Afghanistan  2000  2666   20595360
#&gt; 3 Brazil       1999 37737  172006362
#&gt; # â€¦ with 3 more rows
```
]

---
layout: true

### &gt;&gt; **.red[`separate()`ã€`extract()`]** å’Œ `unite()`

---

&lt;img src="imgs/tidy-5.png" width="55%" style="display: block; margin: auto;" /&gt;

--
.pull-left.code80[


```r
separate(
* data, col, into,
  sep = "[^[:alnum:]]+", 
  remove = TRUE, convert = FALSE, 
  extra = "warn", fill = "warn", ...
)
extract(
* data, col, into,
  regex = "([[:alnum:]]+)", 
  remove = TRUE, convert = FALSE, ...
)
separate_rows(data, ..., sep, convert)
```
]

--

.pull-right.code80[

```r
table3 %&gt;% 
  separate(
    rate,
    into = c("cases", "population"),
    convert = TRUE
  )
```

```
#&gt; # A tibble: 6 Ã— 4
#&gt;   country      year cases population
#&gt;   &lt;chr&gt;       &lt;int&gt; &lt;int&gt;      &lt;int&gt;
#&gt; 1 Afghanistan  1999   745   19987071
#&gt; 2 Afghanistan  2000  2666   20595360
#&gt; 3 Brazil       1999 37737  172006362
#&gt; # â€¦ with 3 more rows
```

]

---
layout: true

### &gt;&gt; `separate()`ã€`extract()` å’Œ **.red[`unite()`]**

---

&lt;img src="imgs/tidy-6.png" width="80%" style="display: block; margin: auto;" /&gt;

--
.pull-left.code100[


```r
unite(
  data, 
  col,
  ...,
  sep = "_", 
  remove = TRUE, 
  na.rm = FALSE
)
```
]

--

.pull-right.code90[

```r
table5 %&gt;% 
  unite(
    col = "year", 
    century, year, sep = ""
  )
```

```
#&gt; # A tibble: 6 Ã— 3
#&gt;   country     year  rate           
#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;          
#&gt; 1 Afghanistan 1999  745/19987071   
#&gt; 2 Afghanistan 2000  2666/20595360  
#&gt; 3 Brazil      1999  37737/172006362
#&gt; # â€¦ with 3 more rows
```

]

---
layout: true

### &gt;&gt; å¤æ‚ä¾‹å­

---


```r
who    # ?who
```

```
#&gt; # A tibble: 7,240 Ã— 60
#&gt;    country     iso2  iso3   year new_sp_â€¦Â¹ new_sâ€¦Â² new_sâ€¦Â³ new_sâ€¦â´ new_sâ€¦âµ new_sâ€¦â¶ new_sâ€¦â·
#&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
#&gt;  1 Afghanistan AF    AFG    1980        NA      NA      NA      NA      NA      NA      NA
#&gt;  2 Afghanistan AF    AFG    1981        NA      NA      NA      NA      NA      NA      NA
#&gt;  3 Afghanistan AF    AFG    1982        NA      NA      NA      NA      NA      NA      NA
#&gt;  4 Afghanistan AF    AFG    1983        NA      NA      NA      NA      NA      NA      NA
#&gt;  5 Afghanistan AF    AFG    1984        NA      NA      NA      NA      NA      NA      NA
#&gt;  6 Afghanistan AF    AFG    1985        NA      NA      NA      NA      NA      NA      NA
#&gt;  7 Afghanistan AF    AFG    1986        NA      NA      NA      NA      NA      NA      NA
#&gt;  8 Afghanistan AF    AFG    1987        NA      NA      NA      NA      NA      NA      NA
#&gt;  9 Afghanistan AF    AFG    1988        NA      NA      NA      NA      NA      NA      NA
#&gt; 10 Afghanistan AF    AFG    1989        NA      NA      NA      NA      NA      NA      NA
#&gt; # â€¦ with 7,230 more rows, 49 more variables: new_sp_f014 &lt;int&gt;, new_sp_f1524 &lt;int&gt;,
#&gt; #   new_sp_f2534 &lt;int&gt;, new_sp_f3544 &lt;int&gt;, new_sp_f4554 &lt;int&gt;, new_sp_f5564 &lt;int&gt;,
#&gt; #   new_sp_f65 &lt;int&gt;, new_sn_m014 &lt;int&gt;, new_sn_m1524 &lt;int&gt;, new_sn_m2534 &lt;int&gt;,
#&gt; #   new_sn_m3544 &lt;int&gt;, new_sn_m4554 &lt;int&gt;, new_sn_m5564 &lt;int&gt;, new_sn_m65 &lt;int&gt;,
#&gt; #   new_sn_f014 &lt;int&gt;, new_sn_f1524 &lt;int&gt;, new_sn_f2534 &lt;int&gt;, new_sn_f3544 &lt;int&gt;,
#&gt; #   new_sn_f4554 &lt;int&gt;, new_sn_f5564 &lt;int&gt;, new_sn_f65 &lt;int&gt;, new_ep_m014 &lt;int&gt;,
#&gt; #   new_ep_m1524 &lt;int&gt;, new_ep_m2534 &lt;int&gt;, new_ep_m3544 &lt;int&gt;, new_ep_m4554 &lt;int&gt;, â€¦
```

---
.code80[

```r
who1 &lt;- who %&gt;% 
  pivot_longer(
    cols = new_sp_m014:newrel_f65,
    names_to = "name", 
    values_to = "cases", 
    values_drop_na = TRUE
  )
who1
```

```
#&gt; # A tibble: 76,046 Ã— 6
#&gt;   country     iso2  iso3   year name         cases
#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;        &lt;int&gt;
#&gt; 1 Afghanistan AF    AFG    1997 new_sp_m014      0
#&gt; 2 Afghanistan AF    AFG    1997 new_sp_m1524    10
#&gt; 3 Afghanistan AF    AFG    1997 new_sp_m2534     6
#&gt; # â€¦ with 76,043 more rows
```
]

--

&gt; å˜é‡ `name` ä¸­çš„å­—ç¬¦ä¸²ä»£è¡¨ä»€ä¹ˆï¼Ÿé€šè¿‡æŸ¥é˜… `who` çš„æ•°æ®å­—å…¸å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š
&gt;  1. å‰3ä¸ªå­—æ¯ä»£è¡¨æ˜¯å¦æ˜¯â€œæ–°å¢â€è‚ºç»“æ ¸ç—…ä¾‹ï¼Œåœ¨æ•°æ®ä¸­å‡ä¸º`new`
&gt;  2. æ¥ä¸‹æ¥2-3ä¸ªå­—æ¯ä»£è¡¨è‚ºç»“æ ¸çš„ç±»å‹ï¼ˆ`sp`ã€`sn`ã€`ep`ã€`rel`ç­‰ï¼‰
&gt;  3. æ¥ä¸‹æ¥çš„å­—æ¯`m`æˆ–`f`ä»£è¡¨è‚ºç»“æ ¸ç—…äººçš„æ€§åˆ«ï¼ˆç”·æˆ–å¥³ï¼‰
&gt;  4. ä½™ä¸‹æ•°å­—ä»£è¡¨å¹´é¾„ç»„ï¼Œå¦‚ `014 = 0 - 14å² | 1524 = 15 - 24å²`

---

.code80[

```r
who2 &lt;- who1 %&gt;% 
  mutate(name = stringr::str_replace(name, "newrel", "new_rel")) %&gt;% 
  separate(name, c(NA, "type", "sexage"), sep = "_")  # åŸºäºåˆ†éš”ç¬¦
who2
```

```
#&gt; # A tibble: 76,046 Ã— 7
#&gt;   country     iso2  iso3   year type  sexage cases
#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;
#&gt; 1 Afghanistan AF    AFG    1997 sp    m014       0
#&gt; 2 Afghanistan AF    AFG    1997 sp    m1524     10
#&gt; 3 Afghanistan AF    AFG    1997 sp    m2534      6
#&gt; # â€¦ with 76,043 more rows
```
]

--

.code80[

```r
who3 &lt;- who2 %&gt;% separate(sexage, c("sex", "age"), sep = 1)  # åŸºäºä½ç½®
who3
```

```
#&gt; # A tibble: 76,046 Ã— 8
#&gt;   country     iso2  iso3   year type  sex   age   cases
#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
#&gt; 1 Afghanistan AF    AFG    1997 sp    m     014       0
#&gt; 2 Afghanistan AF    AFG    1997 sp    m     1524     10
#&gt; 3 Afghanistan AF    AFG    1997 sp    m     2534      6
#&gt; # â€¦ with 76,043 more rows
```
]

---

.code80[

```r
*# all in a pipe!
who %&gt;%
  pivot_longer(cols = new_sp_m014:newrel_f65, 
               names_to = "name", values_to = "cases", values_drop_na = TRUE) %&gt;% 
  mutate(name = stringr::str_replace(name, "newrel", "new_rel")) %&gt;%
  separate(name, c(NA, "type", "sexage")) %&gt;% 
  separate(sexage, c("sex", "age"), sep = 1)
```
]

--

.pull-left.code80[

```r
*# all with powerful pivot_longer()!
who %&gt;%
  pivot_longer(
    cols = starts_with("new"),
*   names_to = c("type", "sex", "age"),
*   names_pattern = "new_?(.*)_(.)(.*)",
*   names_ptypes = list(
*     sex = factor(levels = c("f", "m")),
*     age = factor(
*       levels = c("014", "1524", "2534",
*         "3544", "4554", "5564", "65"),
*       ordered = TRUE)),
    values_to = "cases",
    values_drop_na = TRUE
  )
```
]

.pull-right.code80[


```
#&gt; # A tibble: 76,046 Ã— 8
#&gt;   country  iso2  iso3   year type  sex  
#&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;fct&gt;
#&gt; 1 Afghaniâ€¦ AF    AFG    1997 sp    m    
#&gt; 2 Afghaniâ€¦ AF    AFG    1997 sp    m    
#&gt; 3 Afghaniâ€¦ AF    AFG    1997 sp    m    
#&gt; 4 Afghaniâ€¦ AF    AFG    1997 sp    m    
#&gt; 5 Afghaniâ€¦ AF    AFG    1997 sp    m    
#&gt; # â€¦ with 76,041 more rows, and 2 more
#&gt; #   variables: age &lt;ord&gt;, cases &lt;int&gt;
```

&lt;br&gt;
.font120.bold[ğŸ‘‰  `vignette("pivot")`]
]

---
layout: false
class: hide_logo

## ğŸ™‹â€â™‚ï¸ Your Turn!

&lt;style type="text/css"&gt;
#special_timer.running {
  background-color: black;
  background-image: url(imgs/bg-stars.gif);
}
#special_timer.finished {
  background-color: black;
  background-image: url(imgs/bg-sqfw.gif);
  background-size: cover;
}
#special_timer.running .countdown-digits {
  color: #fdf6e3;
}
#special_timer.finished .countdown-digits {
  color: #fdf6e3;
}
&lt;/style&gt;

<div class="countdown" id="special_timer" data-warn-when="10" data-update-every="1" tabindex="0" style="top:0;right:0;font-size:3em;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

.panelset[

.panel[.panel-name[é—®é¢˜]

.font120[åœ¨ç©ºç™½å¤„å¡«å…¥æ°å½“çš„ä»£ç å°†æ•°æ®é›† billboard è½¬åŒ–ä¸ºç›®æ ‡ç»“æ„ï¼š]



.pull-left.code100[

&lt;code class ='r hljs remark-code'&gt;library(tidyverse)&lt;br&gt;billboard %&gt;% View()&lt;br&gt;billboard %&gt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;pivot_&lt;span style='background-color:#ffff7f'&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;cols = &lt;span style='background-color:#ffff7f'&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;names_to = &lt;span style='background-color:#ffff7f'&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style='background-color:#ffff7f'&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt; ,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;names_transform = &lt;span style='background-color:#ffff7f'&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;values_to = &lt;span style='background-color:#ffff7f'&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;values_drop_na = TRUE&lt;br&gt;&amp;nbsp;&amp;nbsp;)&lt;/code&gt;
]

.pull-right.code80[


```
*# A tibble: 317 Ã— 79
  artist    track date.entâ€¦Â¹   wk1   wk2
  &lt;chr&gt;     &lt;chr&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;
1 2 Pac     Babyâ€¦ 2000-02-26    87    82
2 2Ge+her   The â€¦ 2000-09-02    91    87
3 3 Doors â€¦ Krypâ€¦ 2000-04-08    81    70
# â€¦ with 314 more rows, 74 more
#   variables: wk3 &lt;dbl&gt;, wk4 &lt;dbl&gt;,
#   wk5 &lt;dbl&gt;, wk6 &lt;dbl&gt;, wk7 &lt;dbl&gt;,
#   wk8 &lt;dbl&gt;, wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;,
#   wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;, wk13 &lt;dbl&gt;,
#   wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;,
#   wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, â€¦
```


```
*# A tibble: 5,307 Ã— 5
  artist track    date.entâ€¦Â¹  week  rank
  &lt;chr&gt;  &lt;chr&gt;    &lt;date&gt;     &lt;int&gt; &lt;dbl&gt;
1 2 Pac  Baby Doâ€¦ 2000-02-26     1    87
2 2 Pac  Baby Doâ€¦ 2000-02-26     2    82
3 2 Pac  Baby Doâ€¦ 2000-02-26     3    72
# â€¦ with 5,304 more rows, and
#   abbreviated variable name
#   Â¹â€‹date.entered
```
]
]

.panel[.panel-name[å‚è€ƒç­”æ¡ˆ]

.code110[

```r
library(tidyverse)
billboard %&gt;% View()
billboard %&gt;%
  pivot_longer(
    cols = starts_with("wk") ,
    names_to = "week"        ,
    names_prefix = "wk"      ,
    names_transform = list(week = as.integer),
    values_to = "rank"       ,
    values_drop_na = TRUE
  )
```
]
]
]

---
layout: true

### &gt;&gt; `unnest_*` å’Œ `hoist()`

---
.pull-left.code90[


```r
repurrrsive::gh_repos %&gt;% View()
```

&lt;img src="imgs/repos.png" width="100%" style="display: block; margin: auto auto auto 0;" /&gt;
]

--

.pull-right.code80[


```r
(repos &lt;- 
   tibble(repo = repurrrsive::gh_repos))
```

```
#&gt; # A tibble: 6 Ã— 1
#&gt;   repo       
#&gt;   &lt;list&gt;     
#&gt; 1 &lt;list [30]&gt;
#&gt; 2 &lt;list [30]&gt;
#&gt; 3 &lt;list [30]&gt;
#&gt; 4 &lt;list [26]&gt;
#&gt; 5 &lt;list [30]&gt;
#&gt; # â€¦ with 1 more row
```

```r
(repos &lt;- repos %&gt;% unnest_longer(repo))
```

```
#&gt; # A tibble: 176 Ã— 1
#&gt;   repo             
#&gt;   &lt;list&gt;           
#&gt; 1 &lt;named list [68]&gt;
#&gt; 2 &lt;named list [68]&gt;
#&gt; 3 &lt;named list [68]&gt;
#&gt; 4 &lt;named list [68]&gt;
#&gt; 5 &lt;named list [68]&gt;
#&gt; # â€¦ with 171 more rows
```
]

---

.pull-left.code90[


```r
repos %&gt;% 
  unnest_wider(repo)
```

```
#&gt; # A tibble: 176 Ã— 68
#&gt;         id name     full_â€¦Â¹ owner       
#&gt;      &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;list&gt;      
#&gt; 1 61160198 after    gaborcâ€¦ &lt;named list&gt;
#&gt; 2 40500181 argufy   gaborcâ€¦ &lt;named list&gt;
#&gt; 3 36442442 ask      gaborcâ€¦ &lt;named list&gt;
#&gt; 4 34924886 baseimpâ€¦ gaborcâ€¦ &lt;named list&gt;
#&gt; 5 61620661 citest   gaborcâ€¦ &lt;named list&gt;
#&gt; # â€¦ with 171 more rows, 64 more
#&gt; #   variables: private &lt;lgl&gt;,
#&gt; #   html_url &lt;chr&gt;, description &lt;chr&gt;,
#&gt; #   fork &lt;lgl&gt;, url &lt;chr&gt;,
#&gt; #   forks_url &lt;chr&gt;, keys_url &lt;chr&gt;,
#&gt; #   collaborators_url &lt;chr&gt;,
#&gt; #   teams_url &lt;chr&gt;, hooks_url &lt;chr&gt;, â€¦
```

]

--

.pull-right.code90[


```r
*repos %&gt;% hoist(
  repo, 
* login = c("owner", "login"),
  name = "name",
  homepage = "homepage",
  watchers = "watchers_count"
)
```

```
#&gt; # A tibble: 176 Ã— 5
*#&gt;   login       name       homepâ€¦Â¹ watchâ€¦Â²
*#&gt;   &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;     &lt;int&gt;
#&gt; 1 gaborcsardi after      &lt;NA&gt;          5
#&gt; 2 gaborcsardi argufy     &lt;NA&gt;         19
#&gt; 3 gaborcsardi ask        &lt;NA&gt;          5
#&gt; 4 gaborcsardi baseimporâ€¦ &lt;NA&gt;          0
#&gt; 5 gaborcsardi citest     &lt;NA&gt;          0
#&gt; # â€¦ with 171 more rows, 1 more
#&gt; #   variable: repo &lt;list&gt;, and
#&gt; #   abbreviated variable names
#&gt; #   Â¹â€‹homepage, Â²â€‹watchers
```

&lt;br&gt;
.font120.bold[ğŸ‘‰ `vignette("rectangle")`]

]


---
layout: false
class: inverse, center, middle

# è¯¾åä½œä¸š

---

&lt;br&gt;
.font130[
1\. å¤ä¹  ğŸ“– [_R for Data Science_](https://r4ds.had.co.nz/) ä¸€ä¹¦çš„ç¬¬10ç« ã€ç¬¬11ç« å’Œç¬¬12ç« çš„å†…å®¹

2\. ä¸‹è½½ï¼ˆæ‰“å°ï¼‰ ğŸ“° .bold[[{{Data Importçš„cheatsheet}}](https://posit.co/wp-content/uploads/2022/10/data-import.pdf)] å’Œ .bold[[{{Data Tidyingçš„cheatsheet}}](https://posit.co/wp-content/uploads/2022/10/tidyr.pdf)] å¹¶é˜…è¯»ä¹‹

3\. `browseVignettes(package = c("readr", "tidyr"))` ğŸ“

&gt; .code80[

```
Introduction to readr
Tidy data
Pivoting
```
]

4\. å®Œæˆç¬¬å…­è®²çš„è¯¾åç»ƒä¹  ğŸ‘©â€ğŸ’»

&gt; .code90[

```r
remotes::install_github("qfwr2022/qfwr")
# è®°å¾—é€‰æ‹©å…è®¸å®‰è£…qfwråŒ…æ‰€ä¾èµ–çš„learnrã€testwhatç­‰åŒ…
library(qfwr)
qfwr_ex("L06")
```
]
]

---
class: center, middle, hide_logo
background-image: url(imgs/xaringan.png)
background-size: 12%
background-position: 50% 40%


&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
&lt;hr color='#f00' size='2px' width='80%'&gt;
&lt;br&gt;
.Large.red[_**æœ¬ç½‘é¡µç‰ˆè®²ä¹‰çš„åˆ¶ä½œç”± R åŒ… [{{`xaringan`}}](https://github.com/yihui/xaringan) èµ‹èƒ½ï¼**_]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="../libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
