<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>ç¬¬8è®² å­—ç¬¦ä¸²ã€å› å­å’Œæ—¥æœŸ-æ—¶é—´</title>
    <meta charset="utf-8" />
    <meta name="author" content=" æ›¾æ°¸è‰º" />
    <meta name="date" content="2022-11-18" />
    <script src="../libs/header-attrs/header-attrs.js"></script>
    <link href="../libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="../libs/tile-view/tile-view.js"></script>
    <link href="../libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <link href="../libs/panelset/panelset.css" rel="stylesheet" />
    <script src="../libs/panelset/panelset.js"></script>
    <link href="../libs/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <script src="../libs/clipboard/clipboard.min.js"></script>
    <link href="../libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="../libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-copy\"><\/i>","success":"<i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"<i class=\"fa fa-times-circle\" style=\"color: #F94144\"><\/i>"})</script>
    <link href="../libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="../libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <script src="../libs/htmlwidgets/htmlwidgets.js"></script>
    <link href="../libs/str_view/str_view.css" rel="stylesheet" />
    <script src="../libs/str_view-binding/str_view.js"></script>
    <link rel="stylesheet" href="../libs/zen-styles-v2.3.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# é‡åŒ–é‡‘èä¸é‡‘èç¼–ç¨‹
]
.subtitle[
## <br>L08 å­—ç¬¦ä¸²ã€å› å­å’Œæ—¥æœŸ-æ—¶é—´
]
.author[
### <br>æ›¾æ°¸è‰º
]
.institute[
### å¦é—¨å¤§å­¦ç®¡ç†å­¦é™¢
]
.date[
### <br>2022-11-18
]

---

class: middle
background-image: url(imgs/s-f-l.png)
background-size: 15em
background-position: 90% 85%



<div>
<style type="text/css">.xaringan-extra-logo {
width: 50px;
height: 50px;
z-index: 0;
background-image: url(imgs/logo-sm.png);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
top:0.5em;right:0.5em;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide):not(.inverse):not(.hide_logo)')
        .forEach(function (slide) {
          const logo = document.createElement('div')
          logo.classList = 'xaringan-extra-logo'
          logo.href = null
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div>



--

.pull-left[

### 1. å­—ç¬¦ä¸²

  * .font130[å­—ç¬¦ä¸²åŸºç¡€]
  
  * .font130[æ¨¡å¼åŒ¹é…]
  
  * .font130[å·¥å…·å‡½æ•°]

&lt;br&gt;

### 2. å› å­

  * .font130[å› å­å‘é‡]
  
  * .font130[ä¿®æ”¹å› å­æ°´å¹³]
  
  * .font130[è°ƒæ•´å› å­æ¬¡åº]

]

.pull-right[

### 3. æ—¥æœŸ-æ—¶é—´

  * .font130[åˆ›å»ºæ—¥æœŸ-æ—¶é—´]
  
  * .font130[å¤„ç†æ—¶é—´æˆåˆ†]
  
  * .font130[æ—¶é—´é—´éš”]

]

---
class: inverse, center, middle
background-image: url(imgs/logo-stringr.png), url(imgs/sxc.png)
background-size: 10%, 100%
background-position: 30% 40%, 0% 100%

# 1. å­—ç¬¦ä¸²

.font120[(.bold[`stringr`&lt;sup&gt;.font60[v1.4.1]&lt;/sup&gt;]: Simple, Consistent Wrappers for Common String Operations)]

---
layout: true

### &gt;&gt; 1.1 å­—ç¬¦ä¸²åŸºç¡€

---


```r
# ç”¨ '' æˆ– "" æ¥åˆ›å»ºå­—ç¬¦ä¸²ï¼Œä½†ä¼˜å…ˆç”¨ ""
x &lt;- "This is a string."; x_zh &lt;- 'è¿™æ˜¯ä¸­æ–‡å­—ç¬¦ä¸²ã€‚'
```

--


```r
# è‹¥æƒ³åœ¨å­—ç¬¦ä¸²ä¸­åŒ…æ‹¬'æˆ–"ï¼Œä½ éœ€è¦ä½¿ç”¨è½¬ä¹‰ç¬¦ \
x &lt;- '"This is a string enclosed in \" &amp; \"!"'    # ?'"'
x   # æ‰“å°å­—ç¬¦ä¸²
```

```
#&gt; [1] "\"This is a string enclosed in \" &amp; \"!\""
```

```r
writeLines(x)   # å†™å‡ºå­—ç¬¦ä¸²çš„å†…å®¹
```

```
#&gt; "This is a string enclosed in " &amp; "!"
```

--


```r
# å¯ç›´æ¥è¾“å…¥ç»™å®šUnicodeç¼–ç è¡¨ä»£ç çš„å­—ç¬¦
(zh &lt;- c("\u4e00", "\u9fa5"))  # Unicodeç¼–ç è¡¨ä¸­ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä¸­æ–‡å­—ç¬¦
```

```
#&gt; [1] "ä¸€" "é¾¥"
```

--


```r
# ç”¨c()åˆ›å»ºå­—ç¬¦å‘é‡æ¥å­˜å‚¨å¤šä¸ªå­—ç¬¦ä¸²
(greeting &lt;- c("Good morning", "åŒå­¦ä»¬", "ï¼"))
```

```
#&gt; [1] "Good morning" "åŒå­¦ä»¬"       "ï¼"
```

---

.full-width[.content-box-blue.bold.font120[å­—ç¬¦ä¸²é•¿åº¦]]


```r
c("Good morning", "åŒå­¦ä»¬", "ï¼") %&gt;% str_length()  # {stringr}
# c("Good morning", "åŒå­¦ä»¬", "ï¼") %&gt;% nchar()     # {base}
```

```
#&gt; [1] 12  3  1
```

--

.full-width[.content-box-blue.bold.font120[å­—ç¬¦ä¸²è¿æ¥]]


```r
str_c("X", str_replace_na(c("a", NA, "c"), replacement = "NA"), 1:3, sep = "_")
# paste("X", c("a", NA, "c"), 1:3, sep = "_")
```

```
#&gt; [1] "X_a_1"  "X_NA_2" "X_c_3"
```


```r
str_c("X", str_replace_na(c("a", NA, "c")), 1:3,  sep = "_", 
*     collapse = " |-&gt; ")
paste0("X", c("a", NA, "c"), 1:3, sep = "_", collapse = " |-&gt; ")
str_flatten(c("X", str_replace_na(c("a", NA, "c")), 1:3, sep = "_"), collapse = " |-&gt; ")
```

```
#&gt; [1] "X_a_1 |-&gt; X_NA_2 |-&gt; X_c_3"
#&gt; [1] "Xa1_ |-&gt; XNA2_ |-&gt; Xc3_"
#&gt; [1] "X |-&gt; a |-&gt; NA |-&gt; c |-&gt; 1 |-&gt; 2 |-&gt; 3 |-&gt; _"
```

---

.full-width[.content-box-blue.bold.font120[æå–ï¼ˆä¿®æ”¹ï¼‰å­å­—ç¬¦ä¸²]]

.code110[

```r
greeting
```

```
#&gt; [1] "Good morning" "åŒå­¦ä»¬"       "ï¼"
```

```r
str_sub(greeting, start = 1:3, end = -2)    # æå–
```

```
#&gt; [1] "Good mornin" "å­¦"          ""
```

```r
str_sub(greeting, 1:3, -2) &lt;- LETTERS[1:3]  # ä¿®æ”¹
greeting
```

```
#&gt; [1] "Ag"    "åŒBä»¬" "ï¼C"
```

```r
# base::substr(x, start, stop)
```
]

---
layout: true

### &gt;&gt; 1.2 æ¨¡å¼åŒ¹é…

---

.full-width[.content-box-blue.bold.font120[`stringr` åŒ…å¤šæ•°å‡½æ•°éƒ½æœ‰ `pattern` å‚æ•°ï¼Œé»˜è®¤è°ƒç”¨æ­£åˆ™è¡¨è¾¾å¼å‡½æ•° `regex()`]]

&gt; æ­£åˆ™è¡¨è¾¾å¼ï¼ˆ_Regular Expression, RegEx_ï¼‰æ˜¯ä¸€ç§ç”¨æ¥ç²¾ç®€æè¿°å­—ç¬¦ä¸²æ¨¡å¼çš„è¯­è¨€ã€‚
&gt; `stringr` åŒ…é‡‡ç”¨ `ICU` æ­£åˆ™è¡¨è¾¾å¼å¼•æ“ï¼ˆç±»ä¼¼äº `Perl`ï¼‰ã€‚

--

.pull-left[

```r
x &lt;- c("apple &amp; banana", "ana@è´¢ç®¡2020")

# åŸºç¡€åŒ¹é…ï¼ˆç²¾ç¡®åŒ¹é…æŒ‡å®šå­—ç¬¦ï¼‰
# -----------------------------
str_view(x, pattern = "na")
```

<div id="htmlwidget-e0c80754446792aea569" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-e0c80754446792aea569">{"x":{"html":"<ul>\n  <li>apple & ba<span class='match'>na<\/span>na<\/li>\n  <li>a<span class='match'>na<\/span>@è´¢ç®¡2020<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>



```r
# "." åŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼ˆæ¢è¡Œç¬¦é™¤å¤–ï¼‰
# -----------------------------
str_view(x, pattern = "..a..")
```

<div id="htmlwidget-c07f0f8d61bef8227562" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-c07f0f8d61bef8227562">{"x":{"html":"<ul>\n  <li>apple &<span class='match'> bana<\/span>na<\/li>\n  <li><span class='match'>ana@è´¢<\/span>ç®¡2020<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
]

--

.pull-right[

```r
# ç”¨è½¬ä¹‰ç¬¦"\"è½¬ä¹‰
# -----------------------------
# æ­£åˆ™è¡¨è¾¾å¼"\\."åŒ¹é…å­—ç¬¦"."
str_view(c("abc", "a.c"), "a\\.c")
```

<div id="htmlwidget-3d31c4b31c541d55c861" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-3d31c4b31c541d55c861">{"x":{"html":"<ul>\n  <li>abc<\/li>\n  <li><span class='match'>a.c<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>


```r
# éœ€è¦ç”¨"\\\\"æ¥åŒ¹é…ä¸€ä¸ªå­—ç¬¦"\"ï¼
# str_view("a\\c", "a\\c")
str_view("a\\c", "a\\\\c")
```

<div id="htmlwidget-1958908fb874a8953d68" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-1958908fb874a8953d68">{"x":{"html":"<ul>\n  <li><span class='match'>a\\c<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
]

---

.pull-left.code100[

```r
# é”šå®šç¬¦"^"å’Œ"$"
# ----------------------------

str_view(x, "^a")  # ^ï¼šå¼€å¤´
```

<div id="htmlwidget-9f1c485b0e81c3ef7f2f" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-9f1c485b0e81c3ef7f2f">{"x":{"html":"<ul>\n  <li><span class='match'>a<\/span>pple & banana<\/li>\n  <li><span class='match'>a<\/span>na@è´¢ç®¡2020<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>

```r
str_view(x, "a$")  # $ï¼šç»“å°¾
```

<div id="htmlwidget-405383a8d7980cadea57" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-405383a8d7980cadea57">{"x":{"html":"<ul>\n  <li>apple & banan<span class='match'>a<\/span><\/li>\n  <li>ana@è´¢ç®¡2020<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>

```r
str_view(x, "^ana$")
```

<div id="htmlwidget-e5d8fb33a15003a4fcd6" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-e5d8fb33a15003a4fcd6">{"x":{"html":"<ul>\n  <li>apple & banana<\/li>\n  <li>ana@è´¢ç®¡2020<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
]

--

.pull-right.code95[

```r
# åŒ¹é…ä¸€ç»„å­—ç¬¦ä¸­çš„ä»»æ„ä¸€ä¸ª
# -----------------------------
# "\\d"åŒ¹é…ä»»æ„é˜¿æ‹‰ä¼¯æ•°å­—
# "\\s"åŒ¹é…ä»»æ„ç©ºç™½ç¬¦
#     ï¼ˆå¦‚ç©ºæ ¼ç¬¦ã€tabã€æ¢è¡Œç¬¦ç­‰ï¼‰
# "[abc.]"åŒ¹é…aæˆ–bæˆ–cæˆ–.ï¼ˆæ— éœ€è½¬ä¹‰ï¼‰
# "|"ä¸ºæˆ–ï¼Œ"(a|b|c)"ä¹ŸåŒ¹é…aæˆ–bæˆ–c
# "[a-c]"åŒ¹é…ä»aåˆ°cçš„ä»»æ„å­—ç¬¦
*# "[^abc]"åŒ¹é…éaébå’Œécçš„ä»»æ„å­—ç¬¦

*str_view_all(x, "\\d")
```

<div id="htmlwidget-91e5a1cef3e21577e9c0" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-91e5a1cef3e21577e9c0">{"x":{"html":"<ul>\n  <li>apple & banana<\/li>\n  <li>ana@è´¢ç®¡<span class='match'>2<\/span><span class='match'>0<\/span><span class='match'>2<\/span><span class='match'>0<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>

```r
str_view_all(x, "[\u4e00-\u9fa5]")
```

<div id="htmlwidget-e9f3fe67bcecb62fab30" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-e9f3fe67bcecb62fab30">{"x":{"html":"<ul>\n  <li>apple & banana<\/li>\n  <li>ana@<span class='match'>è´¢<\/span><span class='match'>ç®¡<\/span>2020<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
]


---

.pull-left.code95[

```r
# é‡å¤
# -----------------------------
# ?ï¼š0æˆ–1æ¬¡
# +ï¼šè‡³å°‘1æ¬¡
# *ï¼šä»»æ„æ¬¡æ•°
# {n}ï¼šæ­£å¥½næ¬¡
# {n,}ï¼šè‡³å°‘næ¬¡
# {,m}ï¼šè‡³å¤šmæ¬¡
# {n,m}ï¼šnæ¬¡å’Œmæ¬¡ä¹‹é—´

# ä»å·¦åˆ°å³ä¾æ¬¡æŸ¥æ‰¾ç›´è‡³åŒ¹é…
str_view(x, "(a.)*")
```

<div id="htmlwidget-d6f2e2359b281333371d" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-d6f2e2359b281333371d">{"x":{"html":"<ul>\n  <li><span class='match'>ap<\/span>ple & banana<\/li>\n  <li><span class='match'>ana@<\/span>è´¢ç®¡2020<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>

```r
str_view(x, "(a.){2,}")
```

<div id="htmlwidget-44f0b240b010a6f88eca" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-44f0b240b010a6f88eca">{"x":{"html":"<ul>\n  <li>apple & b<span class='match'>anan<\/span>a<\/li>\n  <li><span class='match'>ana@<\/span>è´¢ç®¡2020<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
]

--

.pull-right.code100[

```r
# é‡å¤
# -----------------------------
# é»˜è®¤ä¸ºâ€œè´ªå©ªâ€ï¼Œæœ€é•¿åŒ¹é…å­—ç¬¦ä¸²
# åŠ ä¸Š?ä¿®æ”¹ä¸ºâ€œæ‡’æƒ°â€ï¼Œæœ€çŸ­åŒ¹é…å­—ç¬¦ä¸²

str_view(x, "(a.){1,}")
```

<div id="htmlwidget-3afbb8df2bcc95e00cc6" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-3afbb8df2bcc95e00cc6">{"x":{"html":"<ul>\n  <li><span class='match'>ap<\/span>ple & banana<\/li>\n  <li><span class='match'>ana@<\/span>è´¢ç®¡2020<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>

```r
str_view(x, "(a.){1,}?")
```

<div id="htmlwidget-4633f14870f3e7ec3d10" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-4633f14870f3e7ec3d10">{"x":{"html":"<ul>\n  <li><span class='match'>ap<\/span>ple & banana<\/li>\n  <li><span class='match'>an<\/span>a@è´¢ç®¡2020<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
]


---

.pull-left.code100[

```r
# åˆ†ç»„ä¸å›æº¯å¼•ç”¨(backreference)
# -----------------------------
# ()ï¼šå­—ç¬¦ä¸²åˆ†ç»„
#   ï¼ˆä½¿ç”¨()ä¹Ÿå¯ä½¿å¾—RegExæ›´æ¸…æ™°ï¼‰
# \1ï¼šå›æº¯å¼•ç”¨ç¬¬1ç»„åŒ¹é…å­—ç¬¦ä¸²

str_view(x, "(.).*\\1")
```

<div id="htmlwidget-81104ac738452b232fda" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-81104ac738452b232fda">{"x":{"html":"<ul>\n  <li><span class='match'>apple & banana<\/span><\/li>\n  <li><span class='match'>ana<\/span>@è´¢ç®¡2020<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>

```r
str_view(x, "(.)(.).\\2\\1")
```

<div id="htmlwidget-44fb028bd2deafacb947" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-44fb028bd2deafacb947">{"x":{"html":"<ul>\n  <li>apple & b<span class='match'>anana<\/span><\/li>\n  <li>ana@è´¢ç®¡2020<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
]

--

.pull-right.code90[

```r
# regex()çš„å‚æ•°
# -----------------------------
# ignore_case = FALSE
# multiline   = FALSE
# comments    = FALSE
# dotall      = FALSE

str_view("AB", 
  regex("ab", ignore_case = TRUE))
```

<div id="htmlwidget-f5993a389474a4cc2a87" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-f5993a389474a4cc2a87">{"x":{"html":"<ul>\n  <li><span class='match'>AB<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>

```r
xd &lt;- regex("
  \\(?        # å¯èƒ½çš„(
  (0592)      # å››ä½åŒºå·0592ï¼Œç¬¬1ç»„
  [^\\d]*     # å¯èƒ½çš„éæ•°å­—ï¼Œå¦‚)ã€-ç­‰
  (218\\d{4}) # 218å¼€å¤´çš„7ä¸ªå·ç ï¼Œç¬¬2ç»„
  ", comments = TRUE)
str_match("0592-2187091", xd)
```

```
#&gt;      [,1]           [,2]   [,3]     
#&gt; [1,] "0592-2187091" "0592" "2187091"
```
]

---

.full-width[.content-box-blue.bold.font120[`pattern` å‚æ•°è¿˜æ”¯æŒ `fixed()`ã€`coll()` å’Œ `boundary()`]]

--
.pull-left.code95[

```r
# fixed()ä¼šå¿½ç•¥ç‰¹æ®Šçš„RegExå­—ç¬¦
# -----------------------------
str_view_all("\\d for 123...", 
             fixed("\\d"))
```

<div id="htmlwidget-4c86225a3d3001429612" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-4c86225a3d3001429612">{"x":{"html":"<ul>\n  <li><span class='match'>\\d<\/span> for 123...<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>



```r
# coll()æŒ‰æ ‡å‡†å­—ç¬¦åˆ†ç±»è§„åˆ™åŒ¹é…å­—ç¬¦
# -----------------------------
str_subset(
  c("I", "Ä°", "i", "Ä±"), 
  coll("i", ignore_case = TRUE, 
       locale = "tr")
)
```

```
#&gt; [1] "Ä°" "i"
```
]

--

.pull-right.code95[

```r
# boundary(type = ...)åŒ¹é…è¾¹ç•Œ
# -----------------------------
# "character"ï¼šé»˜è®¤æŒ‰å­—ç¬¦
# "line_break"ï¼šæŒ‰è¡Œ
# "sentence"ï¼šæŒ‰å¥
# "word"ï¼šæŒ‰è¯

str_view_all(c("å­—ç¬¦ä¸²ä¸å› å­"), 
             boundary())
```

<div id="htmlwidget-c2a7a3979625b5903323" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-c2a7a3979625b5903323">{"x":{"html":"<ul>\n  <li><span class='match'>å­—<\/span><span class='match'>ç¬¦<\/span><span class='match'>ä¸²<\/span><span class='match'>ä¸<\/span><span class='match'>å› <\/span><span class='match'>å­<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>

```r
str_view_all(c("å­—ç¬¦ä¸²ä¸å› å­"), 
             boundary("word"))
```

<div id="htmlwidget-3fc14bab63567589b8b0" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-3fc14bab63567589b8b0">{"x":{"html":"<ul>\n  <li><span class='match'>å­—ç¬¦<\/span><span class='match'>ä¸²<\/span><span class='match'>ä¸<\/span><span class='match'>å› å­<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
]

---
layout: true

### &gt;&gt; 1.3 å·¥å…·å‡½æ•°

---

.full-width[.content-box-blue.bold.font120[åŒ¹é…ä¸å¦åŠåŒ¹é…æ¬¡æ•°ï¼š`str_detect()` å’Œ `str_count()`]]

--

.pull-left.code90[

```r
# xå‘é‡ä¸­å“ªäº›å­—ç¬¦ä¸²åŒ…å«æ•°å­—ï¼Ÿ
str_detect(x, "\\d")
```

```
#&gt; [1] FALSE  TRUE
```

```r
# å†…ç½®å‘é‡wordsä¸­ä»¥å…ƒéŸ³å­—æ¯ç»“å°¾è¯å æ¯”
mean(str_detect(words, "[aeiou]$"))
```

```
#&gt; [1] 0.277
```

```r
# æå–wordsä¸­ä»¥å­—æ¯xç»“å°¾çš„è¯
words[str_detect(words, "x$")]
```

```
#&gt; [1] "box" "sex" "six" "tax"
```

```r
# ç­‰åŒäº
str_subset(words, "x$")
```

```
#&gt; [1] "box" "sex" "six" "tax"
```
]

--

.pull-right.code85[

```r
# åœ¨æ•°æ®æ¡†ä¸­æ­é…filter()ä½¿ç”¨
df &lt;- tibble(word = words, 
             i = seq_along(word))
df %&gt;% filter(str_detect(words, "x$"))
```

```
#&gt; # A tibble: 4 Ã— 2
#&gt;   word      i
#&gt;   &lt;chr&gt; &lt;int&gt;
#&gt; 1 box     108
#&gt; 2 sex     747
#&gt; 3 six     772
#&gt; 4 tax     841
```

```r
# ä½¿ç”¨mutate()+str_count()ç»Ÿè®¡åŒ¹é…æ¬¡æ•°
df %&gt;% mutate(
  vo = str_count(words, "[^aeiou]"))
```

```
#&gt; # A tibble: 980 Ã— 3
#&gt;   word      i    vo
#&gt;   &lt;chr&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1 a         1     0
#&gt; 2 able      2     2
#&gt; 3 about     3     2
#&gt; # â€¦ with 977 more rows
```
]

---

.full-width[.content-box-blue.bold.font120[æ›¿æ¢åŒ¹é…ï¼š`str_replace()` å’Œ `str_replace_all()`]]

--

.pull-left.code95[

```r
# å°†xå‘é‡ä¸­çš„å…ƒéŸ³å­—æ¯æ›¿æ¢ä¸º"*"
str_replace(x, "[aeiou]", "*")
```

```
#&gt; [1] "*pple &amp; banana" "*na@è´¢ç®¡2020"
```


```r
# str_replace()åªæ›¿æ¢äº†ç¬¬ä¸€ä¸ªåŒ¹é…
# str_replace_all()è¿›è¡Œå…¨éƒ¨æ›¿æ¢
# å¦‚ä¸‹å¯åˆ é™¤å…¨éƒ¨å…ƒéŸ³å­—æ¯
str_replace_all(x, "[aeiou]", "")
```

```
#&gt; [1] "ppl &amp; bnn"  "n@è´¢ç®¡2020"
```

```r
# ç­‰åŒäº
str_remove_all(x, "[aeiou]")
```

```
#&gt; [1] "ppl &amp; bnn"  "n@è´¢ç®¡2020"
```
]

--

.pull-right.code95[

```r
# é€šè¿‡æŒ‡å®šå‘½åå‘é‡å®Œæˆå¤šé‡æ›¿æ¢
x2 &lt;- c("1 car", "2 cats", 
        "3 cups")
str_replace_all(x2, 
  c("1" = "one", "\\d" = "some"))
```

```
#&gt; [1] "one car"   "some cats" "some cups"
```


```r
# å›æº¯å¼•ç”¨æ›¿æ¢
str_replace(
  x, 
  "^(...)(.*)(...)$", 
  "\\3\\2\\1"
)
```

```
#&gt; [1] "anale &amp; banapp" "020@è´¢ç®¡2ana"
```
]

---

.full-width[.content-box-blue.bold.font120[åŒ¹é…åˆ†å‰²ï¼š`str_split()` å’Œ `str_split_fixed()`]]

--

.code90[

```r
info &lt;- c("å§“å: å¼ ä¸‰ &amp; æå››", "å¹´é¾„ @ 20 &amp; 21", "å®¿èˆ @ L2-111")
```
]

--
.pull-left.code95[


```r
# åœ¨ç»™å®špatternå¤„
# å°†å­—ç¬¦ä¸²å‘é‡infoåˆ†å‰²ä¸ºåˆ—è¡¨
info %&gt;% str_split(" ?[:@&amp;] ")
# é»˜è®¤å‚æ•°n = Inf, simplify = FALSE
```

```
#&gt; [[1]]
#&gt; [1] "å§“å" "å¼ ä¸‰" "æå››"
#&gt; 
#&gt; [[2]]
#&gt; [1] "å¹´é¾„" "20"   "21"  
#&gt; 
#&gt; [[3]]
#&gt; [1] "å®¿èˆ"   "L2-111"
```
]

--

.pull-right.code85[

```r
# åˆ†å‰²ä¸ºçŸ©é˜µ
info %&gt;% str_split(" ?[:@&amp;] ", 
           n = 2, simplify = TRUE)
```

```
#&gt;      [,1]   [,2]         
#&gt; [1,] "å§“å" "å¼ ä¸‰ &amp; æå››"
#&gt; [2,] "å¹´é¾„" "20 &amp; 21"    
#&gt; [3,] "å®¿èˆ" "L2-111"
```

```r
# åˆ†å‰²ä¸ºçŸ©é˜µ
info %&gt;% 
  str_split_fixed(" ?[:@&amp;] ", n = 4)
```

```
#&gt;      [,1]   [,2]     [,3]   [,4]
#&gt; [1,] "å§“å" "å¼ ä¸‰"   "æå››" ""  
#&gt; [2,] "å¹´é¾„" "20"     "21"   ""  
#&gt; [3,] "å®¿èˆ" "L2-111" ""     ""
```
]

---

.full-width[.content-box-blue.bold.font120[æå–åŒ¹é…ï¼š`str_extract()` å’Œ `str_extract_all()`]]

--

.pull-left.code80[

```r
head(sentences, n = 5)  # 720 in total
```

```
#&gt; [1] "The birch canoe slid on the smooth planks." 
#&gt; [2] "Glue the sheet to the dark blue background."
#&gt; [3] "It's easy to tell the depth of a well."     
#&gt; [4] "These days a chicken leg is a rare dish."   
#&gt; [5] "Rice is often served in round bowls."
```

```r
# æƒ³ä»ä¸­æ‰¾å‡ºå«æœ‰2ç§åŠä»¥ä¸Šå½©è™¹é¢œè‰²å•è¯çš„å¥å­
rainbow &lt;- c("red", "orange", "yellow", 
             "green", "blue", "indigo", 
             "purple")
rb_match &lt;- str_c(rainbow, 
                  collapse = "|")
rb_match
```

```
#&gt; [1] "red|orange|yellow|green|blue|indigo|purple"
```
]

--

.pull-right.code80[


```r
more &lt;- sentences[
  str_count(sentences, rb_match) &gt;= 2]
str_view_all(more, rb_match)
```

<div id="htmlwidget-0ac826c25a932da933a2" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-0ac826c25a932da933a2">{"x":{"html":"<ul>\n  <li>It is hard to erase <span class='match'>blue<\/span> or <span class='match'>red<\/span> ink.<\/li>\n  <li>The <span class='match'>green<\/span> light in the brown box flicke<span class='match'>red<\/span>.<\/li>\n  <li>The sky in the west is tinged with <span class='match'>orange<\/span> <span class='match'>red<\/span>.<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>

```r
str_extract(more, rb_match)
```

```
#&gt; [1] "blue"   "green"  "orange"
```

```r
str_extract_all(more, rb_match, 
                simplify = TRUE)
```

```
#&gt;      [,1]     [,2] 
#&gt; [1,] "blue"   "red"
#&gt; [2,] "green"  "red"
#&gt; [3,] "orange" "red"
```
]

---

.full-width[.content-box-blue.bold.font120[åˆ†ç»„æå–åŒ¹é…ï¼š`str_match()` å’Œ `str_match_all()`]]

--

.code90[

```r
# æƒ³ä»ä¸­sentencesæ•°æ®é›†ä¸­æ‰¾å‡ºåè¯ï¼ˆä½¿ç”¨å¯å‘å¼æ³•åˆ™ï¼šåœ¨å† è¯aæˆ–theåé¢ï¼‰
noun &lt;- "(a|the) +([^ ]+)"
sentences %&gt;% str_subset(noun) %&gt;% head(2) -&gt; has_noun
```
]

--

.pull-left.code85[

```r
has_noun %&gt;% str_extract(noun)
```

```
#&gt; [1] "the smooth" "the sheet"
```
]

--

.pull-right.code85[

```r
has_noun %&gt;% str_match(noun)
```

```
#&gt;      [,1]         [,2]  [,3]    
#&gt; [1,] "the smooth" "the" "smooth"
#&gt; [2,] "the sheet"  "the" "sheet"
```
]

--

.code90[

```r
# åœ¨tibbleä¸­ä½¿ç”¨tidyr::extract()å¯èƒ½æ›´æ–¹ä¾¿
tibble(sentence = sentences) %&gt;% 
  extract(sentence, c("article", "noun"), "(a|the) +([^ ]+)", remove = FALSE)
```

```
#&gt; # A tibble: 720 Ã— 3
#&gt;   sentence                                    article noun  
#&gt;   &lt;chr&gt;                                       &lt;chr&gt;   &lt;chr&gt; 
#&gt; 1 The birch canoe slid on the smooth planks.  the     smooth
#&gt; 2 Glue the sheet to the dark blue background. the     sheet 
#&gt; 3 It's easy to tell the depth of a well.      the     depth 
#&gt; # â€¦ with 717 more rows
```
]

---

.full-width[.content-box-blue.bold.font120[æœ€åè®©æˆ‘ä»¬çœ‹ä¸‹ `stringr` åŒ…ä¸­ç©¶ç«Ÿæœ‰å¤šå°‘ä¸ªä»¥ `str_` å¼€å¤´çš„å‡½æ•°]]

.code85[

```r
*ls("package:stringr", pattern = "^str_") %&gt;%
  matrix(ncol = 5, byrow = TRUE) -&gt; strfuns

strfuns[9, 3:5] &lt;- "-"

strfuns %&gt;% as_tibble(.name_repair = "unique") %&gt;% print(n = 9)
```

```
#&gt; # A tibble: 9 Ã— 5
#&gt;   ...1           ...2            ...3            ...4            ...5          
#&gt;   &lt;chr&gt;          &lt;chr&gt;           &lt;chr&gt;           &lt;chr&gt;           &lt;chr&gt;         
#&gt; 1 str_c          str_conv        str_count       str_detect      str_dup       
#&gt; 2 str_ends       str_extract     str_extract_all str_flatten     str_glue      
#&gt; 3 str_glue_data  str_interp      str_length      str_locate      str_locate_all
#&gt; 4 str_match      str_match_all   str_order       str_pad         str_remove    
#&gt; 5 str_remove_all str_replace     str_replace_all str_replace_na  str_sort      
#&gt; 6 str_split      str_split_fixed str_squish      str_starts      str_sub       
#&gt; 7 str_sub&lt;-      str_subset      str_to_lower    str_to_sentence str_to_title  
#&gt; 8 str_to_upper   str_trim        str_trunc       str_view        str_view_all  
#&gt; 9 str_which      str_wrap        -               -               -
```
]

---
layout: false
class: inverse, center, middle
background-image: url(imgs/logo-forcats.png), url(imgs/sxc.png)
background-size: 10%, 100%
background-position: 30% 40%, 0% 100%

# 2. å› å­

.font120[(.bold[`forcats`&lt;sup&gt;.font60[v0.5.2]&lt;/sup&gt;]: Tools for Working with Categorical Variables (Factors))]

---
layout: true

### &gt;&gt; 2.1 å› å­å‘é‡

---
.full-width[.content-box-blue.bold.font120[æˆ‘ä»¬å¯ä»¥å°†å­—ç¬¦ä¸²ç›´æ¥å­˜å…¥å­—ç¬¦å‘é‡ä¸­ ...]]


```r
x1 &lt;- c("Excelence", "Good", "Average", "Pass", "Failed")
```

--

.full-width[.content-box-blue.bold.font120[... ä½†ä»¥å­—ç¬¦æ–¹å¼å­˜å‚¨æ•°æ®å¯èƒ½é¢ä¸´ä¸¤ä¸ªé—®é¢˜]]

.font120[
* å–å€¼æ°´å¹³é—®é¢˜ï¼šå°½ç®¡æˆ‘ä»¬çŸ¥é“æˆç»©ç­‰çº§æ°´å¹³åªæœ‰5ä¸ªï¼Œä½†å­—ç¬¦æ–¹å¼æ— æ³•ä¿è¯ä½ æ²¡æœ‰è¾“å…¥é”™è¯¯
]


```r
x2 &lt;- c("Excelence", "Good", "Averege", "Pass", "Failed") # "Averege" è¾“å…¥é”™äº†
```

.font120[
* æ’åºé—®é¢˜ï¼šå¯èƒ½æ— æ³•å¾—åˆ°æœ‰æ„ä¹‰çš„æ’åºç»“æœ &lt;sup&gt;.red[*]&lt;/sup&gt;
]


```r
sort(x1)
```

```
#&gt; [1] "Average"   "Excelence" "Failed"    "Good"      "Pass"
```

.footnote.red.font100[*ï¼šè€Œæˆ‘ä»¬åœ¨åˆ¶è¡¨ã€ä½œå›¾ç­‰åœºåˆé€šå¸¸éœ€è¦ä¿æŒåˆç†çš„æ’åºä¿¡æ¯ã€‚]

---

.pull-left[

.full-width[.content-box-blue.bold.font120[åˆ›å»ºå› å­å‘é‡ ...]]


```r
# 1. è®¾å®šåˆæ³•çš„å› å­æ°´å¹³åŠå…¶æ¬¡åº
grade_levels &lt;- c(
  "Failed", "Pass", "Average",
  "Good", "Excelence"
)

# 2. å°†å­—ç¬¦å‘é‡è½¬å˜ä¸ºå› å­å‘é‡
y1 &lt;- factor(x1, 
             levels = grade_levels)
y1
```

```
#&gt; [1] Excelence Good      Average   Pass      Failed   
#&gt; Levels: Failed Pass Average Good Excelence
```
]

--

.pull-right[

.full-width[.content-box-blue.bold.font120[... æœ‰åŠ©äºå…‹æœè¿™ä¸¤ä¸ªé—®é¢˜]]


```r
#1. ä¸åˆæ³•çš„å­—ç¬¦å–å€¼å°†å˜ä¸º`NA`
y2 &lt;- factor(x2, 
             levels = grade_levels)
y2
```

```
#&gt; [1] Excelence Good      &lt;NA&gt;      Pass      Failed   
#&gt; Levels: Failed Pass Average Good Excelence
```

```r
#2. æ’åºæ­£ç¡®
sort(y1)
```

```
#&gt; [1] Failed    Pass      Average   Good      Excelence
#&gt; Levels: Failed Pass Average Good Excelence
```
]

---

.full-width[.content-box-blue.bold.font120[å…¶å®ƒè¯´æ˜]]

* R ä»¥æ•´æ•°å­˜å‚¨å› å­å‘é‡ &lt;br&gt;

&lt;img src="imgs/factor-1.png" width="95%" style="display: block; margin: auto;" /&gt;

--

.pull-left[

* è‹¥ä½¿ç”¨ `readr::parse_factor()`ï¼Œå‡ºç°ä¸åˆæ³•çš„è¾“å…¥æ—¶ä¼šç»™ä½ æé†’

  
  ```r
  y2 &lt;- parse_factor(x2, 
              levels = grade_levels)
  ```
  
  ```
  #&gt; Warning: 1 parsing failure.
  #&gt; row col           expected  actual
  #&gt;   3  -- value in level set Averege
  ```
]

--

.pull-right[

* è‹¥ä¸æŒ‡å®šå› å­æ°´å¹³çš„ `levels` å‚æ•°ï¼Œåˆ™ä»¥å­—ç¬¦æ’åºä½œä¸ºå› å­é¡ºåº

  
  ```r
  factor(x1)
  as.integer(factor(x1))
  # unclass(factor(x1))
  ```
  
  ```
  #&gt; [1] Excelence Good      Average   Pass      Failed   
  #&gt; Levels: Average Excelence Failed Good Pass
  #&gt; [1] 2 4 1 5 3
  ```
]

---
layout: true

### &gt;&gt; 2.2 ä¿®æ”¹å› å­æ°´å¹³

---

.pull-left.code95[

```r
# ç¤ºä¾‹æ•°æ®é›†
gss_cat
```

```
#&gt; # A tibble: 21,483 Ã— 9
#&gt;     year marital         age race 
#&gt;    &lt;int&gt; &lt;fct&gt;         &lt;int&gt; &lt;fct&gt;
#&gt;  1  2000 Never married    26 White
#&gt;  2  2000 Divorced         48 White
#&gt;  3  2000 Widowed          67 White
#&gt;  4  2000 Never married    39 White
#&gt;  5  2000 Divorced         25 White
#&gt;  6  2000 Married          25 White
#&gt;  7  2000 Never married    36 White
#&gt;  8  2000 Divorced         44 White
#&gt;  9  2000 Married          44 White
#&gt; 10  2000 Married          47 White
#&gt; # â€¦ with 21,473 more rows, and 5
#&gt; #   more variables: rincome &lt;fct&gt;,
#&gt; #   partyid &lt;fct&gt;, relig &lt;fct&gt;,
#&gt; #   denom &lt;fct&gt;, tvhours &lt;int&gt;
```
]

--

.pull-right.code100[

```r
# æŸ¥çœ‹ç‰¹å®šå˜é‡çš„å› å­æ°´å¹³åŠå…¶è®¡æ•°
gss_cat %&gt;% 
  count(partyid)
```

```
#&gt; # A tibble: 10 Ã— 2
#&gt;    partyid                n
#&gt;    &lt;fct&gt;              &lt;int&gt;
#&gt;  1 No answer            154
#&gt;  2 Don't know             1
#&gt;  3 Other party          393
#&gt;  4 Strong republican   2314
#&gt;  5 Not str republican  3032
#&gt;  6 Ind,near rep        1791
#&gt;  7 Independent         4119
#&gt;  8 Ind,near dem        2499
#&gt;  9 Not str democrat    3690
#&gt; 10 Strong democrat     3490
```
]

---
.full-width[.content-box-blue.bold.font120[`fct_recode()`ï¼šæ‰‹åŠ¨æ”¹å˜å› å­æ°´å¹³]]
--

.code95[

```r
gss_cat %&gt;% mutate(
  partyid = fct_recode(
    partyid,
    "Republican, strong"    = "Strong republican",
    "Republican, weak"      = "Not str republican",
    "Independent, near rep" = "Ind,near rep",
    "Independent, near dem" = "Ind,near dem",
    "Democrat, weak"        = "Not str democrat",
    "Democrat, strong"      = "Strong democrat",
*   "Other"                 = "No answer",
*   "Other"                 = "Don't know",
*   "Other"                 = "Other party"
    # fct_recode()ä¸­æœªæŒ‡å®šçš„å› å­æ°´å¹³ Independent å°†ä¿æŒåŸæ ·
  )
) %&gt;% count(partyid)
```

```
#&gt; # A tibble: 8 Ã— 2
#&gt;   partyid                n
#&gt;   &lt;fct&gt;              &lt;int&gt;
#&gt; 1 Other                548
#&gt; 2 Republican, strong  2314
#&gt; 3 Republican, weak    3032
#&gt; # â€¦ with 5 more rows
```
]

---

.full-width[.content-box-blue.bold.font120[`fct_collapse()`ï¼šåˆå¹¶å› å­æ°´å¹³]]
--

.code90[

```r
# fct_collapse()å‡½æ•°æ˜¯fct_recode()å‡½æ•°çš„ä¸€ç§å˜ä½“
gss_cat %&gt;% mutate(
  partyid = fct_collapse(
    partyid,
    other = c("No answer", "Don't know", "Other party"),
    rep = c("Strong republican", "Not str republican"),
    ind = c("Ind,near rep", "Independent", "Ind,near dem"),
    dem = c("Not str democrat", "Strong democrat")
    # å·¦è¾¹æ»¡è¶³Råˆæ³•å˜é‡åçš„å› å­æ°´å¹³æ— éœ€ä½¿ç”¨""ï¼ˆä½†è¦ç”¨""ä¹Ÿè¡Œï¼‰
    # å› å­æ°´å¹³çš„é¡ºåºä»¥åœ¨`fct_collapse()`ä¸­å‡ºç°çš„å…ˆåä¸ºåº
  )
) %&gt;% count(partyid)
```

```
#&gt; # A tibble: 4 Ã— 2
#&gt;   partyid     n
#&gt;   &lt;fct&gt;   &lt;int&gt;
#&gt; 1 other     548
#&gt; 2 rep      5346
#&gt; 3 ind      8409
#&gt; 4 dem      7180
```
]

---

.full-width[.content-box-blue.bold.font120[`fct_lump*()`ï¼šå°†æœ€ä¸å¸¸è§/æœ€å¸¸è§çš„å› å­æ°´å¹³å½’å¹¶ä¸º "Other"]]
--

.pull-left.code90[

```r
gss_cat %&gt;%
  count(relig, sort = TRUE)
```

```
#&gt; # A tibble: 15 Ã— 2
#&gt;    relig                       n
#&gt;    &lt;fct&gt;                   &lt;int&gt;
#&gt;  1 Protestant              10846
#&gt;  2 Catholic                 5124
#&gt;  3 None                     3523
#&gt;  4 Christian                 689
#&gt;  5 Jewish                    388
#&gt;  6 Other                     224
#&gt;  7 Buddhism                  147
#&gt;  8 Inter-nondenominational   109
#&gt;  9 Moslem/islam              104
#&gt; 10 Orthodox-christian         95
#&gt; 11 No answer                  93
#&gt; 12 Hinduism                   71
#&gt; 13 Other eastern              32
#&gt; 14 Native american            23
#&gt; 15 Don't know                 15
```
]

--

.pull-right.code90[

```r
gss_cat %&gt;%
  mutate(
    relig = fct_lump_n(
      relig, 
*     n = 5,  # è´Ÿæ•°å½’å¹¶æœ€å¸¸è§çš„æ°´å¹³
*     other_level = "Other"  # é»˜è®¤
    )
  ) %&gt;% 
  count(relig, sort = TRUE)
```

```
#&gt; # A tibble: 6 Ã— 2
#&gt;   relig          n
#&gt;   &lt;fct&gt;      &lt;int&gt;
#&gt; 1 Protestant 10846
#&gt; 2 Catholic    5124
#&gt; 3 None        3523
*#&gt; 4 Other        913
#&gt; 5 Christian    689
#&gt; 6 Jewish       388
```
]

---
layout: true

### &gt;&gt; 2.3 è°ƒæ•´å› å­æ¬¡åº

---
.full-width[.content-box-blue.bold.font120[æœ‰æ—¶é»˜è®¤çš„å› å­æ¬¡åºå¹¶ä¸æ»¡è¶³ä½ çš„è¦æ±‚ ...]]

--

.pull-left.code95[

```r
# æ¢ç´¢åˆ†æä¿¡ä»°ä¸åŒå®—æ•™çš„äººåœ¨
# æ¯æ—¥çœ‹ç”µè§†æ—¶é—´æ–¹é¢çš„å·®å¼‚
relig_summary &lt;- gss_cat %&gt;%
* group_by(relig) %&gt;%
  summarise(
    age = mean(age, na.rm = TRUE),
*   tvhours = mean(tvhours,
*                  na.rm = TRUE),
    n = n()
  )

# ä½œå›¾
ggplot(relig_summary, 
       aes(tvhours, relig)) + 
  geom_point()
```
]

.pull-right[
&lt;img src="L08_String_Factor_Datetime_files/figure-html/unnamed-chunk-59-1.png" width="100%" style="display: block; margin: auto;" /&gt;

- å¾ˆéš¾ä»ä¸Šå›¾ä¸­çœ‹å‡ºç‰¹å®šæ¨¡å¼å¹¶è¿›è¡Œç›¸åº”çš„åˆ†æï¼ŒğŸ˜¢
]

---

.full-width[.content-box-blue.bold.font100[`fct_reorder()`ï¼šåŸºäºå¦ä¸€å˜é‡å–å€¼çš„æ’åºæ¥è°ƒæ•´å› å­æ¬¡åº]]
--

.code95[

```r
# fct_reorder(.f, .x, .fun = median, ..., .desc = FALSE)
relig_summary %&gt;% 
  ggplot(aes(tvhours, fct_reorder(relig, tvhours))) + 
  geom_point()
```
]

.pull-left[
&lt;img src="L08_String_Factor_Datetime_files/figure-html/unnamed-chunk-60-1.png" width="100%" /&gt;
]

--

.pull-right.code95[

```r
# å·¦å›¾çš„çºµåæ ‡æ ‡é¢˜æœ‰ç‚¹å¥‡æ€ª -&gt;
# ä½œå›¾å‰å…ˆç”Ÿæˆæ–°å˜é‡å¯èƒ½æ˜¯ä¸ªæ›´å¥½çš„åšæ³•
relig_summary %&gt;% 
* mutate(
*   relig = fct_reorder(relig,
*                       tvhours)
* ) %&gt;%
  ggplot(aes(tvhours, relig)) + 
  geom_point()
```
]

---

.full-width[.content-box-blue.bold[`fct_relevel()`ï¼šæ‰‹åŠ¨è°ƒæ•´å› å­æ¬¡åº]]
--

.code90[

```r
# fct_relevel(.f, ..., after = 0L)
relig_summary %&gt;% 
  mutate(relig = fct_relevel(relig, "No answer", after = Inf)) %&gt;% 
  arrange(relig)
```
]

--

.full-width[.content-box-blue.bold[`fct_infreq() | fct_inorder() | fct_inseq()`ï¼šåˆ†åˆ«æ ¹æ®é¢‘æ•°ä»å¤§åˆ°å° | åœ¨æ•°æ®é›†ä¸­å‡ºç°å…ˆå | æ•°å­—é¡ºåºæ¥è°ƒæ•´å› å­æ¬¡åº]]

--

.full-width[.content-box-blue.bold[`fct_rev()`ï¼šåè½¬å› å­æ¬¡åº]]
--

.pull-left.code90[

```r
gss_cat %&gt;%
* mutate(marital =
*          marital %&gt;%
*          fct_infreq() %&gt;%
*          fct_rev()) %&gt;%
  ggplot(aes(marital)) + geom_bar()
```
]

.pull-right[
&lt;img src="L08_String_Factor_Datetime_files/figure-html/unnamed-chunk-63-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

---
layout: false
class: inverse, center, middle
background-image: url(imgs/logo-lubridate.png), url(imgs/sxc.png)
background-size: 10%, 100%
background-position: 25% 40%, 0% 100%

# 3. æ—¥æœŸ-æ—¶é—´

.font120[(.bold[`lubridate`&lt;sup&gt;.font60[v1.9.0]&lt;/sup&gt;]: Make Dealing with Dates a Little Easier)]

---
layout: true

### &gt;&gt; 3.1 åˆ›å»ºæ—¥æœŸ-æ—¶é—´

---

.full-width[.content-box-blue.bold.font120[`readr::parse_datetime() | parse_date() | parse_time()`]]

--

.code85[

```r
parse_datetime(x, format = "", na = c("", "NA"), locale = default_locale())
# format: If unset, parsed as ISO8601 with formats specified in the locale().
```
]

--

.pull-left.code85[


```r
- Year: "%Y"(4 digits); "%y"(2 digits)
- Month:
  "%m"(2 digits) 
  "%b"(abbr. name in locale()) 
  "%B"(full name in locale())
- Day: 
  "%d"(2 digits)
  "%e"(optional leading space)
- Hour:
  "%H"(0-23)
  "%I"(0-12, used with "%p")
- AM/PM indicator: "%p"
- Minutes: "%M"
- Seconds: 
  "%S"(integer seconds)
  "%OS"(real seconds)
```
]

--

.pull-right.code85[

```r
- Time zone:
  "%Z"(name, e.g. "America/Chicago")
  "%z"(offset from UTC, e.g. "+0800")
- Non-digits:
  "%." skips one non-digit
  "%+" skips one or more non-digits
  "%*" skips any number non-digits
```


```r
parse_datetime("2022-11-10 12:00")
```

```
#&gt; [1] "2022-11-10 12:00:00 UTC"
```

```r
parse_date("11/10/y21", "%m/%d/%.%y")
```

```
#&gt; [1] "2021-11-10"
```
]

---

.full-width[.content-box-blue.bold.font120[`lubridate::ymd_hms() | ymd() ...`]]

--

.pull-left.code95[


```r
*library(lubridate) # æ‰‹åŠ¨åŠ è½½
```


```r
ymd("2022-11-10")
```

```
#&gt; [1] "2022-11-10"
```


```r
# All are Date 2022-11-10
dmy("10-11, 2022")

ymd(20221110)  # unquoted numbers

# Sys.getlocale("LC_TIME")
ymd("2022åä¸€æœˆ10æ—¥") # â€œæ—¥â€ä¼šè¢«å¿½ç•¥
```
]

--

.pull-right.code95[

```r
# truncated formats
ymd("2022", truncated = 2)
```

```
#&gt; [1] "2022-01-01"
```


```r
ymd_hms("2022-11-10 20:11:59")
```

```
#&gt; [1] "2022-11-10 20:11:59 UTC"
```

```r
mdy_hm("11-10 2022 !08:11 PM")
```

```
#&gt; [1] "2022-11-10 20:11:00 UTC"
```


```r
# &lt;date&gt; with tz -&gt; &lt;dttm&gt;
ymd(20221110, tz = "UTC")
```

```
#&gt; [1] "2022-11-10 UTC"
```
]

---

.full-width[.content-box-blue.bold.font120[`lubridate::make_datetime() | make_date()`]]

--

.code90[

```r
(flights_dt &lt;- nycflights13::flights %&gt;% 
  filter(!is.na(dep_time), !is.na(arr_time)) %&gt;% 
  mutate(
    dep_dttm = make_datetime(
      year, month, day,               # year, month, day
      dep_time%/%100, dep_time%%100   # hour, min,   sec = 0
    ),
    arr_dttm = make_datetime(
      year, month, day,               # year, month, day
      arr_time%/%100, arr_time%%100   # hour, min,   sec = 0
    )
  ) %&gt;% 
  select(origin, dest, dep_time, arr_time, ends_with("_dttm")))
```

```
#&gt; # A tibble: 328,063 Ã— 6
#&gt;   origin dest  dep_time arr_time dep_dttm            arr_dttm           
#&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;int&gt;    &lt;int&gt; &lt;dttm&gt;              &lt;dttm&gt;             
#&gt; 1 EWR    IAH        517      830 2013-01-01 05:17:00 2013-01-01 08:30:00
#&gt; 2 LGA    IAH        533      850 2013-01-01 05:33:00 2013-01-01 08:50:00
#&gt; 3 JFK    MIA        542      923 2013-01-01 05:42:00 2013-01-01 09:23:00
#&gt; # â€¦ with 328,060 more rows
```
]

---

.full-width[.content-box-blue.bold.font120[`lubridate::make_datetime() | make_date()`]]

--

.code95[

```r
flights_dt %&gt;% 
* filter(dep_dttm &lt; ymd(20130102)) %&gt;%    # &lt;dttm&gt; å¯å’Œ &lt;date&gt; ç›´æ¥æ¯”è¾ƒå¤§å°
  ggplot(aes(dep_dttm)) + 
  geom_freqpoly(binwidth = 600) +         # 600s = 10 minutes
  scale_x_datetime(date_labels = "%H:%M") # è®¾å®šåæ ‡è½´æ—¶é—´åˆ»åº¦æ ‡ç­¾çš„æ˜¾ç¤ºæ ¼å¼
```

&lt;img src="L08_String_Factor_Datetime_files/figure-html/unnamed-chunk-75-1.png" width="55%" style="display: block; margin: auto;" /&gt;
]

---

.full-width[.content-box-blue.bold.font120[`lubridate::as_datetime() | as_date()`]]

--

.pull-left.code100[

```r
# S4 method for 
# signature 'POSIXt' and 'Date'
as_datetime(today())
```

```
#&gt; [1] "2022-11-17 UTC"
```

```r
as_date(now())
```

```
#&gt; [1] "2022-11-17"
```
]

--

.pull-right.code90[

```r
# S4 method for 
# signature 'numeric'
# é»˜è®¤å‚æ•°origin = lubridate::origin
#         tz = "UTC"
as_datetime(60 * 60 * 10)
```

```
#&gt; [1] "1970-01-01 10:00:00 UTC"
```

```r
# é»˜è®¤å‚æ•°origin = lubridate::origin
as_date(365 * 10 + 2)      
```

```
#&gt; [1] "1980-01-01"
```

```r
# S4 method for 
# signature 'character'
as_datetime("2019/10/14 10:00", 
    format = "%Y/%m/%d %H:%M")
```

```
#&gt; [1] "2019-10-14 10:00:00 UTC"
```
]


---
layout: true

### &gt;&gt; 3.2 å¤„ç†æ—¶é—´æˆåˆ†

---

.full-width[.content-box-blue.bold.font120[`lubridate::year() | month() ...`ï¼šæå–|æ›´æ”¹æ—¶é—´æˆåˆ†]]

--

.pull-left.code80[

```r
datetime &lt;- ymd_hm("2022/11/10 10:00")

# æå–æ—¶é—´æˆåˆ†
# -------------------------------
month(datetime, label = TRUE)
```

```
#&gt; [1] Nov
#&gt; Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; Jun &lt; Jul &lt; Aug &lt; Sep &lt; Oct &lt; Nov &lt; Dec
```

```r
mday(datetime)
```

```
#&gt; [1] 10
```

```r
yday(datetime)
```

```
#&gt; [1] 314
```

```r
wday(datetime, label = TRUE)
```

```
#&gt; [1] Thu
#&gt; Levels: Sun &lt; Mon &lt; Tue &lt; Wed &lt; Thu &lt; Fri &lt; Sat
```
]

--

.pull-right.code85[

```r
# æ›´æ”¹æ—¶é—´æˆåˆ†
# -------------------------------
# å°±åœ°ä¿®æ”¹datetime
year(datetime) &lt;- 2020
datetime
```

```
#&gt; [1] "2020-11-10 10:00:00 UTC"
```

```r
wday(datetime) &lt;- wday(datetime) + 1
datetime
```

```
#&gt; [1] "2020-11-11 10:00:00 UTC"
```

```r
# åŒæ—¶æ›´æ”¹å¤šä¸ªæˆåˆ†å¹¶ç”Ÿæˆæ–°çš„æ—¥æœŸ-æ—¶é—´
# åŸæ¥çš„datetimeä¿æŒä¸å˜
update(datetime, year = 2020, 
       month = 2, hour = 2)
```

```
#&gt; [1] "2020-02-11 02:00:00 UTC"
```
]

---

.full-width[.content-box-blue.bold.font120[`lubridate::year() | month() ...`ï¼šæå–|æ›´æ”¹æ—¶é—´æˆåˆ†]]


```r
flights_dt %&gt;% 
* mutate(wday = wday(dep_dttm, label = TRUE)) %&gt;%
  ggplot(aes(x = wday)) +
    geom_bar()
```

&lt;img src="L08_String_Factor_Datetime_files/figure-html/unnamed-chunk-80-1.png" width="52%" style="display: block; margin: auto;" /&gt;

---

.full-width[.content-box-blue.bold.font120[`lubridate::floor_date() ...`ï¼šæ—¶é—´æˆåˆ†å–æ•´]]

--


```r
# floor_date(x, unit = "second", week_start = getOption("lubridate.week.start", 7))
# unit: second, minute, hour, day, week, month, year, 
#       bimonth, quarter, season, halfyear; 3 months, etc.
flights_dt %&gt;% 
* count(week = floor_date(dep_dttm, unit = "week")) %&gt;%
  ggplot(aes(week, n)) + geom_line() + 
  scale_x_datetime(date_labels = "%YW%U")  # ?strptime
```

&lt;img src="L08_String_Factor_Datetime_files/figure-html/unnamed-chunk-81-1.png" width="50%" style="display: block; margin: auto;" /&gt;


---
layout: true

### &gt;&gt; 3.3 æ—¶é—´é—´éš”ï¼ˆtime spansï¼‰

---

`lubridate`åŒ…æä¾›ä¸‰ç§è®°å½•/å¤„ç†æ—¶é—´é—´éš”çš„æ–¹å¼ï¼š
*   _`duration`_ï¼šç”¨ç§’ç²¾ç¡®è®°å½•/å¤„ç†ï¼Œ`dseconds() | dhours() ...`
*   _`period`_ï¼šç”¨äººä»¬ç†Ÿæ‚‰çš„æ–¹å¼è®°å½•/å¤„ç†ï¼Œ`seconds() | hours() ...`
*   _`interval`_ï¼šè®°å½•èµ·ç‚¹-ç»ˆç‚¹ä¹‹é—´çš„æ—¶é—´é—´éš”ï¼Œ`%--%`

--

.pull-left.code80[

```r
# Durations
# ---------------------------------------
dyears(1)
```

```
#&gt; [1] "31557600s (~1 years)"
```

```r
# Periods
# ---------------------------------------
years(1)
```

```
#&gt; [1] "1y 0m 0d 0H 0M 0S"
```

```r
# Intervals
# ---------------------------------------
today() %--% (today() + years(1))
```

```
#&gt; [1] 2022-11-17 UTC--2023-11-17 UTC
```
]

--

.pull-right.code80[

```r
# A leap year
ymd("2016-01-01") + dyears(1)  # ?!
```

```
#&gt; [1] "2016-12-31 06:00:00 UTC"
```

```r
ymd("2016-01-01") + years(1)
```

```
#&gt; [1] "2017-01-01"
```

```r
# Arithmetic operations
y1 &lt;- ymd("2016-01-01")
y2 &lt;- y1 + years(1)
(y1 %--% y2) / ddays(1)
```

```
#&gt; [1] 366
```

```r
(y1 %--% y2) %/% days(1)
```

```
#&gt; [1] 366
```
]


---

.full-width[.content-box-blue.bold.font120[ä¸åŒæ•°æ®ç±»å‹ä¹‹é—´å…è®¸çš„è¿ç®—]]

&lt;img src="imgs/datetimes-arithmetic.png" width="65%" style="display: block; margin: auto;" /&gt;

--

.code90[

```r
# ç¤ºä¾‹
flights_dt &lt;- flights_dt %&gt;% 
  mutate(
    overnight = arr_dttm &lt; dep_dttm,
    arr_dttm = arr_dttm + days(overnight * 1),
  )
# Now all flights obey the laws of physics
flights_dt %&gt;% filter(overnight, arr_dttm &lt; dep_dttm) 
```

```
#&gt; # A tibble: 0 Ã— 7
#&gt; # â€¦ with 7 variables: origin &lt;chr&gt;, dest &lt;chr&gt;, dep_time &lt;int&gt;, arr_time &lt;int&gt;,
#&gt; #   dep_dttm &lt;dttm&gt;, arr_dttm &lt;dttm&gt;, overnight &lt;lgl&gt;
```
]

---
layout: false
class: inverse, center, middle

# è¯¾åä½œä¸š

---
class: middle

### è¯¾åä½œä¸š

.Large[

1. æ ¹æ®æœ¬è®²è®²ä¹‰çš„æ‰“å°ç¨¿ï¼Œåœ¨ ğŸ“‘ _Rmd_ ä¸­é”®å…¥å¹¶å®Œæˆä»£ç çš„è¿è¡Œ

1. **å¤ä¹ ** ğŸ“– [_R for Data Science_](https://r4ds.had.co.nz/) ä¸€ä¹¦å…³äº [å­—ç¬¦ä¸²](https://r4ds.had.co.nz/strings.html)ã€[å› å­](https://r4ds.had.co.nz/factors.html) å’Œ [æ—¥æœŸ-æ—¶é—´](https://r4ds.had.co.nz/dates-and-times.html) ç­‰ä¸‰ç§é‡è¦æ•°æ®ç±»å‹ä»¥åŠç›¸åº”å¤„ç†å‡½æ•°çš„å†…å®¹ï¼ˆä¸ºä¸­æ–‡ç¿»è¯‘ç‰ˆçš„ç¬¬10ç« ã€ç¬¬11ç« å’Œç¬¬12ç« ï¼‰

1. ä¸‹è½½ï¼ˆæ‰“å°ï¼‰ğŸ“° [.bold[{{`stringr`çš„cheatsheet}}]](https://posit.co/wp-content/uploads/2022/10/strings.pdf)ã€[.bold[{{`forcats`çš„cheatsheet}}]](https://posit.co/wp-content/uploads/2022/10/factors.pdf) å’Œ [.bold[{{`lubridate`çš„cheatsheet}}]](https://posit.co/wp-content/uploads/2022/10/lubridate.pdf) å¹¶é˜…è¯»ä¹‹

1. å®Œæˆç¬¬å…«è®²çš„è¯¾åç»ƒä¹  ğŸ‘©â€ğŸ’»
  
&gt; .code100[

```r
remotes::install_github("qfwr2022/qfwr")
library(qfwr)
qfwr_ex("L08")
```
]
]

---
class: center, middle, hide_logo
background-image: url(imgs/xaringan.png)
background-size: 12%
background-position: 50% 40%


&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
&lt;hr color='#f00' size='2px' width='80%'&gt;
&lt;br&gt;
.Large.red[_**æœ¬ç½‘é¡µç‰ˆè®²ä¹‰çš„åˆ¶ä½œç”± R åŒ… [{{`xaringan`}}](https://github.com/yihui/xaringan) èµ‹èƒ½ï¼**_]

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="../libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
